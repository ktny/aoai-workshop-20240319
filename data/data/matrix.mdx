---
title: マトリックス
---
import Img from "../../components/Img.tsx";

:version[2.3.0]

マトリックスで分析する方法について、説明します。\
マトリックスでは、さまざまな切り口でクロス集計をおこなうことができます。\
また、集計結果からグラフの作成や、関連性の高いインサイトの確認、および分析の掘り下げをおこなうことができます。

## マトリックスの作成

1. [プロジェクト詳細]画面から、画面左側の[分析]を選択します。
1. [分析]画面が表示されますので、[+分析を作成]ボタンをクリックします。
1. リレーションが設定されていないデータセットがある場合は、確認画面が表示されます。\
   表示される画面にて、[分析を作成]ボタンをクリックします。
1. [新規分析作成]画面が表示されますので、分析名を入力後、[分析種別]から[マトリックス]を選択して[作成]ボタンをクリックします。
1. 集計に使用する項目を[追加するフィールド]から[列]、[行]、[値]欄にドラッグ&ドロップして追加します。

   :::note{.hint}
   ヒント

   - [追加するフィールド]には、データセットの項目、セグメント、特徴量が表示され集計に使用することができます。\
     また、各データセットをマウスオーバーすると右部に表示されるアイコンから、データのプレビューを確認できます。
   - 追加した項目を集計対象からはずす場合は、項目欄の外にドラッグしてください。
   - 追加した項目の順番を入れ替える場合は、項目名をドラッグ&ドロップして移動してください。
   - [値]欄への項目追加は、以下の方法でも可能です。:version[2.1.4]
     - [fx]ボタン：\
       プロジェクトに登録されている数式から選択できます。
     - [+]ボタン：:version[2.4.0]\
       集計方法を選択、または数式を入力して指定することができます。\
       後述の[値の設定]画面における[クイック]、および[カスタム]と同様です。

     上記の方法で追加した場合は、後述の手順6.の集計方法の設定は不要です。
   - [リレーションプレビュー]ボタンをクリックすると、データセット間のリレーションの状態を確認することができます。:version[2.1.4]\
     デフォルト以外のリレーション設定を使用する場合は、[リレーション設定]から選択してください。
   - マトリックス表上でデータや行/列見出しをダブルクリックすると、該当するデータの詳細を確認できます。:version[2.4.0]\
     また、[分析用データ表示]画面にて以下の操作が可能です。
     - 画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、表示するデータを一時的に絞り込むことができます。
       - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
       - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
         なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
       - フィルターをクリックすると、条件を再設定できます。\
         なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
       　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

       なお、変更したフィルター設定は、画面を閉じるとリセットされます。
     - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。:version[2.1.6]\
       再度ダブルクリックすると、固定が解除されます。
     - [リストビューを作成]ボタンをクリックすると、表示されているデータセットの内容でリストビューを作成できます。:version[2.3.0]
     - 表示されているデータセットの内容を[エクスポート]ボタンからエクスポートできます。:version[2.1.5]\
       出力する形式を以下のいずれかから選択し、必要項目を入力の上、[出力]ボタンをクリックしてください。

       | 出力形式                      | 設定内容                                                                                             |
       | ---------------------------- | ---------------------------------------------------------------------------------------------------- |
       | CSVファイル出力               | 出力するファイル名と区切り文字を指定します。                                                            |
       | データベースに出力            | データベースの接続情報と出力先のテーブルを指定します。                                                   |
       |                              | 設定方法の詳細は、「[各種データベースに出力](/guide/output-to-database/index.html)」を参照してください。 |
       | KI内のデータセットとして出力   | [新規作成]、または[既存データセットを上書き]のいずれかから選択します。                                   |
       |                              |  - [新規作成]を選択した場合：データセットの出力先を選択します。                                          |
       |                              |  - [既存データセットを上書き]を選択した場合：上書きするデータセットを選択します。                         |
   :::

1. 続けて、[値]に追加した項目の[▼]ボタンから集計方法や表示の設定をおこない[保存]ボタンをクリックします。\
   :version[2.1.5]

   <Img src="/assets/img/capture/capture-matrix-1.png" alt="マトリックス" client:load />

   [値の設定]画面では、以下の項目を設定することができます。
   - [集計設定]：
     - [クイック]：:version[2.4.0]\
       集計の対象列と集計方法を指定します。\
       集計方法は、以下のいずれかから選択してください。\
       なお、[値]に文字列型の項目を追加した場合は、「個数」、「ユニーク数」、「最頻」のいずれかから指定できます。
       | 種類                       | 説明                                         |
       | -------------------------- | ------------------------------------------- |
       | 合計                       | レコードの合計値を計算します。                |
       | 個数                       | レコード数を計算します。                      |
       |                            | 値が欠損しているレコードはカウントされません。 |
       | ユニーク数                 | 重複を除いたレコード数を計算します。           |
       | 平均                       | レコードの平均値を計算します。                |
       | 最大                       | レコードの最大値を計算します。                |
       | 最小                       | レコードの最小値を計算します。                |
       | 最頻                       | レコードの最頻値を計算します。                |

       上記の集計方法は、[値]欄の[▼]ボタンから直接設定することも可能です。

       特定のデータのみで集計したい場合は、[集計対象データのフィルター]から絞り込む条件を設定してください。\
       [+条件を追加]ボタンをクリックすると、AND条件を追加できます。
     - [カスタム]：\
       数式を入力して指定することができます。
     - [数式]：:version[2.1.4]\
       プロジェクトに登録されている数式から選択できます。

   - [表示設定]：\
     集計結果が数値型の場合のみ設定できます。
     - [書式設定]：\
       数値の表示方法や表示形式を設定します。\
       [表示形式]に「標準」を設定した場合は、表示単位やプレフィックス/サフィックスを追加で設定できます。
     - [セルの色設定]：\
       セルの背景色、および文字色を設定します。\
       「カラースケール」、または「データバー」を指定した場合は、しきい値を設定することも可能です。\
       しきい値の指定方法は以下のいずれかから選択できます。

       | 種類                       | 説明                                                                         |
       | -------------------------- | ---------------------------------------------------------------------------- |
       | 自動                       | 対象列のデータの範囲に応じて自動で設定されます。                                |
       |                            | この指定方法は「データバー」を指定した場合のみ選択できます。                     |
       |                            | 設定されるしきい値は以下のとおりです。                                         |
       |                            | 　・正の数のみ                                                                |
       |                            | 　　・最小しきい値：0                                                         |
       |                            | 　　・最大しきい値：データの最大値                                             |
       |                            | 　・負の数のみ                                                                |
       |                            | 　　・最小しきい値：データの最小値                                             |
       |                            | 　　・最大しきい値：0                                                         |
       |                            | 　・正の数と負の数が混在                                                      |
       |                            | 　　・最小しきい値：データの最小値                                             |
       |                            | 　　・最大しきい値：データの最大値                                             |
       | パーセント                 | データの最小値を0％、最大値を100％としたときの値の割合で指定します。             |
       | 数値                       | 数値で指定します。                                                            |

       なお、しきい値を超える値に色を適用しない場合は、[しきい値を超える値は色を適用しない]にチェックを入れてください。

:::note{.hint}
ヒント

- [説明を追加]をクリックすると、分析に説明を追加することができます。:version[2.4.0]\
 「http://」、または「https://」で始まる文字列はURLと認識され、リンクで表示されます。
  リンクは[Ctrl]キーを押しながらクリックし、表示される画面の[OK]ボタンをクリックすると開くことができます(別タブ表示)。
- [値]欄に複数の項目を指定した場合、自動的に[行]欄に「値」項目が追加され、行で集計します。 列で集計をする場合は、[列]欄に「値」項目をドラッグ&ドロップしてください。
- [集計設定]で[数式]を選択した場合の[表示設定]の初期値を、[数式]画面から設定することができます。:version[2.2.0]\
  詳細については、「[数式画面](/guide/project-details/index.html#数式画面)」を参照してください。
- 集計する行/列を複数の組み合わせで管理したい場合は、マトリックス表下の[+]ボタンからタブを追加してください。:version[2.1.4]\
  なお、タブの名前変更、複製および削除は、タブ名右横の展開ボタンからおこなえます。
- [保存]ボタン右端の展開ボタンから[別名で保存]を選択すると、設定した内容を別名で保存することもできます。
- 分析がロックされている場合は、[保存]ボタンは表示されず、[別名で保存]ボタンから別名保存のみ可能です。
 :::

## 分析結果の確認
:version[2.2.0]

[分析]画面の一覧から、作成したマトリックスを選択して分析結果を確認できます。\
KIでは、作成したマトリックス表から関連が深い項目を自動で抽出しインサイトに表示します。\
また、インサイトから要因ツリーへ移動して、さらに分析を掘り下げることもできます。\
各項目の見方は、以下を参照してください。

<Img src="/assets/img/capture/capture-matrix-2.png" alt="マトリックス" client:load />

1. クリックすると、全画面表示に切り換わります。:version[2.4.0]\
   再度クリックすると、通常の画面表示に戻ります。\
   なお、全画面表示中のURLを他のユーザーに共有すると、そのURLを開いたユーザーも同様に全画面表示で閲覧することができます。
1. クリックすると、1つ前の画面に戻ります。
1. クリックすると、分析の名前を変更できます。
1. クリックすると、ブックマークに追加できます。:version[2.2.0]\
   ブックマークから削除する場合は、再度アイコンをクリックしてください。
1. データセットや分析を最新の内容に更新します。\
   ボタンをクリックして表示される画面から、更新対象を指定してください。
1. クリックすると、保存した時点の内容に戻します。
1. クリックすると、マトリックス表をCSVファイルで出力します。
1. クリックすると、分析における詳細設定ができます。
   - 列設定\
     分析に使用する列を指定できます。\
     データセットの項目、セグメント、特徴量から指定することができます。
   - 表示設定:version[2.1.5]\
     以下の項目を設定できます。
     - 行総計を表示する
     - 列総計を表示する
     - 小計を表示する(行の小計のみ表示されます。値が複数の場合「値」フィールドが列にある必要があります。):version[2.2.0]
     - マイナスを赤文字にする
1. [+]ボタンをクリックしてフィルターを追加することにより、表示するデータを絞り込むことができます。:version[2.4.0]
   - 各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
   - フィルターの追加時に[すべてのタブに適用]にチェックを入れると、すべてのタブに適用されるフィルターを追加することができます。:version[2.1.5]
   - フィルターの色によって、適用される範囲が異なります。:version[2.1.5]
     - 薄いグレー：すべてのタブに適用
     - 濃いグレー：各タブ内でのみ適用
   - フィルターをクリックすると、条件やフィルターの適用範囲を再設定することができます。:version[2.2.0]\
     なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
     [フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。
   - 追加したフィルターを削除する場合は、フィルターをクリックして表示されるメニューの[フィルター削除]ボタンをクリックしてください。
1. 分析の説明が表示されます。:version[2.1.5]:version[2.4.0]\
   クリックすると編集できます。
1. マトリックス表が表示されます。最大で1000列、10000行を表示できます。
   - マトリックス表上で選択するデータに応じて、画面右側の分析用データとインサイトが切り換わります。\
     データを選択していない場合は、マトリックス表全体に対する分析用データとインサイトが表示されます。
   - データの選択方法は、以下の2種類があります。
     - 単一セル：\
       表中のデータをクリックしてください。
     - 行(列)全体：\
       行(列)の項目名をクリックしてください。
   - データ同士を比較する場合は、分析するデータを選択後、[Ctrl]キー(Mac OSの場合は[Command⌘]キー)を押しながら比較するデータを選択してください。:version[2.1.6]\
     分析するデータは緑色、比較するデータはオレンジ色でハイライト表示されます。
   - マトリックス表上でデータや行/列見出しをダブルクリックすると、該当するデータの詳細を確認できます。:version[2.4.0]\
     また、[分析用データ表示]画面にて以下の操作が可能です。
     - 画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、表示するデータを一時的に絞り込むことができます。
       - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
       - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
         なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
       - フィルターをクリックすると、条件を再設定できます。\
         なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
       　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

       なお、変更したフィルター設定は、画面を閉じるとリセットされます。
     - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。:version[2.1.6]\
       再度ダブルクリックすると、固定が解除されます。
     - [リストビューを作成]ボタンをクリックすると、表示されているデータセットの内容でリストビューを作成できます。:version[2.3.0]
     - 表示されているデータセットの内容を[エクスポート]ボタンからエクスポートできます。:version[2.1.5]\
       出力する形式を以下のいずれかから選択し、必要項目を入力の上、[出力]ボタンをクリックしてください。
       | 出力形式                      | 設定内容                                                                                             |
       | ---------------------------- | ---------------------------------------------------------------------------------------------------- |
       | CSVファイル出力               | 出力するファイル名と区切り文字を指定します。                                                            |
       | データベースに出力            | データベースの接続情報と出力先のテーブルを指定します。                                                   |
       |                              | 設定方法の詳細は、「[各種データベースに出力](/guide/output-to-database/index.html)」を参照してください。 |
       | KI内のデータセットとして出力   | [新規作成]、または[既存データセットを上書き]のいずれかから選択します。                                   |
       |                              |  - [新規作成]を選択した場合：データセットの出力先を選択します。                                          |
       |                              |  - [既存データセットを上書き]を選択した場合：上書きするデータセットを選択します。                         |

   - マトリックス表上でデータを右クリックすると、集計値の設定、および集計値の昇順・降順による行の並び替えをおこなえます。:version[2.1.5]
1. クリックすると、行を名前の昇順、または降順に並べ替えることができます(集計値に基づいて並べ替えたい場合は、マトリックス表上のデータを右クリックします)。
1. クリックすると、行、または列をドリルダウン/ドリルアップして表示できます。
1. 行全体、または列全体をドリルダウン/ドリルアップして表示できます。\
   プルダウンから、「列」、または「行」を選択し、右横のボタンにてドリルダウン/ドリルアップを指定します。
1. マトリックス表に表示する[値]の項目を設定できます。\
   ボタンをクリックして表示される画面から、表示する項目を指定してください。
1. 分析を複数のタブで管理できます。:version[2.1.4]\
   集計する行/列を複数の組み合わせで分析したい場合などに利用できます。\
   タブの編集方法については、前述の「[マトリックスの作成](#マトリックスの作成)」の手順6.のヒントを参照してください。
1. クリックすると、画面右側の表示を開閉できます。
1. クリックすると[分析]タブに切り換わり、インサイトを確認できます。
1. クリックすると[表設定]タブに切り換わり、マトリックスの設定を編集することができます。\
   編集方法については、前述の「[マトリックスの作成](#マトリックスの作成)」の手順5.以降を参照してください。
1. 関連するデータセットを確認できます。:version[2.4.0]\
   マトリックス表上でデータを選択していない場合は、分析に使用しているすべてのデータセットが表示され、マトリックス表上でデータを選択した場合は、選択したデータに関連するデータセットが表示されます。\
   また、[分析用データ表示]画面にて以下の操作が可能です。
     - 画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、表示するデータを一時的に絞り込むことができます。
       - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
       - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
         なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
       - フィルターをクリックすると、条件を再設定できます。\
         なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
       　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

       なお、変更したフィルター設定は、画面を閉じるとリセットされます。
   - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。:version[2.1.6]\
     再度ダブルクリックすると、固定が解除されます。
   - [リストビューを作成]ボタンをクリックすると、表示されているデータセットの内容でリストビューを作成できます。:version[2.3.0]
   - 表示されているデータセットの内容を[エクスポート]ボタンからエクスポートできます。:version[2.1.5]\
     出力する形式を以下のいずれかから選択し、必要項目を入力の上、[出力]ボタンをクリックしてください。
     | 出力形式                      | 設定内容                                                                                             |
     | ---------------------------- | ---------------------------------------------------------------------------------------------------- |
     | CSVファイル出力               | 出力するファイル名と区切り文字を指定します。                                                            |
     | データベースに出力            | データベースの接続情報と出力先のテーブルを指定します。                                                   |
     |                              | 設定方法の詳細は、「[各種データベースに出力](/guide/output-to-database/index.html)」を参照してください。 |
     | KI内のデータセットとして出力   | [新規作成]、または[既存データセットを上書き]のいずれかから選択します。                                   |
     |                              |  - [新規作成]を選択した場合：データセットの出力先を選択します。                                          |
     |                              |  - [既存データセットを上書き]を選択した場合：上書きするデータセットを選択します。                         |

1. マトリックスの分析結果を使ってグラフを作成します。:version[2.3.0]:version[2.4.0]\
   表示される画面から、作成するグラフを選択してください。\
   なお、上部のプルダウンからグラフ種別やグラフに使用したい値を選択すると、候補のグラフが絞り込まれます。\
   グラフについては、「[グラフ](/guide/graph/index.html)」を参照してください。
1. インサイトが表示されます。
   - マトリックス表上でデータを選択していない場合は、全体に対するインサイトが表示され、マトリックス表上でデータを選択した場合は、選択したデータに対するインサイトが表示されます。
   - カード上にマウスオーバーすると、比較対象のデータがマトリックス表上でハイライト表示されます。
     - カードとハイライトを固定する場合：\
       カードをクリックしてください。解除する場合は、再度カードをクリックしてください。
     - 要因ツリーで分析をする場合：\
       [要因ツリーで分析]ボタンをクリックしてください。\
       要因ツリーについては、「[要因ツリー](/guide/factor-analysis/index.html)」を参照してください。
1. クリックすると、データセット間のリレーションの状態を確認することができます。\
   使用するリレーションを変更する場合は、右上の[リレーション設定]からリレーションを選択してください。
1. クリックすると、設定した内容を保存します。
   - 右端の展開ボタンから[別名で保存]を選択すると、別名で保存することもできます。
   - 分析がロックされている場合は、[保存]ボタンは表示されず、[別名で保存]ボタンから別名保存のみ可能です。
