---
title: 要因ツリー
---
import Img from "../../components/Img.tsx";

要因ツリーで分析する方法について、説明します。:version[2.2.0]\
要因ツリーでは、分析対象に設定した集計値(KPIなど)において、比較対象との違いが最も現れている要因を確認することができます。\
また、要因となる分析軸を追加したり、値を切り替えたりすることにより分析結果をさらに掘り下げることもできます。

## 要因ツリーの作成

1. [プロジェクト詳細]画面から、画面左側の[分析]を選択します。
1. [分析]画面が表示されますので、[+分析を作成]ボタンをクリックします。
1. リレーションが設定されていないデータセットがある場合は、確認画面が表示されます。\
   表示される画面にて、[分析を作成]ボタンをクリックします。
1. [新規分析作成]画面が表示されますので、分析名を入力後、[分析種別]から[要因ツリー]を選択して[作成]ボタンをクリックします。\
   :version[2.3.0]
1. [要因ツリー]画面が表示されますので、[分析する値]の[編集]ボタンをクリックします。\
   :version[2.4.0]
1. [値の設定]画面が表示されますので、分析の対象にする値の集計方法や表示に関する設定をおこない、[OK]ボタンをクリックします。\
   :version[2.1.5]

   :::note{.hint}
   ヒント

   [値の設定]画面では、以下の項目を設定することができます。
   - [集計設定]：\
     集計に関する設定を以下のいずれかから選択できます。

     - [クイック]：:version[2.4.0]\
       集計の対象列と集計方法をプルダウンから選択します。\
       特定のデータのみで集計したい場合は、[集計対象データのフィルター]から絞り込む条件を設定してください。\
       [+条件を追加]ボタンをクリックすると、AND条件を追加できます。
     - [カスタム]：\
       数式を指定します。\
       数式の指定は、[列選択]ボタンから数式に使用する列の追加や、[fx]ボタンから関数を追加することもできます。\
       使用できる関数については、「[関数一覧](/guide/function-list/index.html)」を参照してください。
     - [数式]：\
       プロジェクトに登録されている数式をプルダウンから選択します。
   - [表示設定]：\
     数値の表示方法や表示形式を設定します。

     - [表示形式]に「標準」を設定した場合は、表示単位やプレフィックス/サフィックスを追加で設定できます。
     - [集計設定]で[数式]を選択した場合の[表示設定]の初期値を、[数式]画面から設定することができます。:version[2.2.0]\
       詳細については、「[数式画面](/guide/project-details/index.html#数式画面)」を参照してください。
   :::

1. 次に分析で使用するグループを設定します。\
   [グループ]の[+グループを追加]ボタンをクリックすると[グループ一覧]画面が表示されますので、[+グループを追加]ボタンからグループを追加してください。
   - グループの条件は、データセットの項目、セグメント、特徴量から指定できます。
   - グループは最大6件まで設定できます。\
     各グループの用途は以下のとおりです。
     - 選択グループ：\
       分析対象となるグループを設定します。
     - 比較グループ：\
       分析対象との比較に使用するグループを設定します。
     - 参考グループ1～4：\
       分析の参考にするグループを設定します。\
       参考値として、カード上に数値やグラフを表示できます。

   なお、グループ間での比較をしない場合は、選択グループのみで分析することも可能です。\
   :version[2.4.0]

:::note{.hint}
ヒント

[説明を追加]をクリックすると、分析に説明を追加することができます。:version[2.4.0]\
「http://」、または「https://」で始まる文字列はURLと認識され、リンクで表示されます。
リンクは[Ctrl]キーを押しながらクリックし、表示される画面の[OK]ボタンをクリックすると開くことができます(別タブ表示)。
:::

## 分析結果の確認

[分析]画面の一覧から、作成した要因ツリーを選択して分析結果を確認できます。\
設定した分析指標において、2つのグループの違いを画面中央のツリー表示にて確認できます。\
また、ツリーを展開して、分析結果をさらに掘り下げることもできます。\
各項目の見方は、以下を参照してください。

<Img src="/assets/img/capture/capture-factor-analysis-1.png" alt="要因ツリー" client:load />

1. クリックすると、全画面表示に切り換わります。:version[2.4.0]\
   再度クリックすると、通常の画面表示に戻ります。\
   なお、全画面表示中のURLを他のユーザーに共有すると、そのURLを開いたユーザーも同様に全画面表示で閲覧することができます。
1. クリックすると、1つ前の画面に戻ります。
1. クリックすると、分析の名前を変更できます。
1. クリックすると、ブックマークに追加できます。:version[2.2.0]\
   ブックマークから削除する場合は、再度アイコンをクリックしてください。
1. データセットや分析を最新の内容に更新します。\
   ボタンをクリックして表示される画面から、更新対象を指定してください。
1. クリックすると、保存した時点の内容に戻します。
1. 要因ツリーをエクスポートします。\
   クリックして表示されるメニューから、データ(CSVファイル)か、キャプチャ(PNGファイル)を指定してください。
1. クリックすると、設定した内容を保存します。
   - 右端の展開ボタンから[別名で保存]を選択すると、別名で保存することもできます。
   - 分析がロックされている場合は、[保存]ボタンは表示されず、[別名で保存]ボタンから別名保存のみ可能です。
1. 分析の対象にする値の集計方法や表示の設定ができます。\
   設定する項目については、「[要因ツリーの作成](#要因ツリーの作成)」の手順6.のヒントを参照してください。\
   マトリックスから遷移した場合は、マトリックスで選択した集計値が設定されます。
   :::note{.hint}
   ヒント

   - [表示設定]画面の[表示方法]で「各グループに対する比率」を指定した場合は、選択グループと比較グループのいずれについても、項目番号16で表示される要因ツリーの左端のカード(すべて)の値を1として、その値に対する相対比率をツリー上に表示します。\
     なお、マトリックスで行(列)同士を選択して要因ツリーに遷移した場合は、「各グループに対する比率」が設定されます。
   - マトリックスの[値]欄の[表示設定]で[表示方法]に「行(列)総計に対する比率」を指定し、要因ツリーに遷移した場合は、 要因ツリーの[表示設定]の[表示方法]には「全総計に対する比率」が設定され、マトリックスで指定した範囲のみが要因ツリーの分析対象となるように自動でフィルターが追加されます。
   :::
1. 分析する値の比較方法を「差」か「比率」から指定します。\
   分析するグループが2グループ以上設定されている場合に指定可能です。
1. クリックすると以下の値を表示、および設定できます。:version[2.4.0]
   - [分析する値]：\
     分析の対象とする値を表示します。\
     値名をクリックして[値の設定]を選択すると、集計方法や表示に関する項目を設定できます。
   - [切り替える値]：\
     以下の値を表示します。
     - マトリックスで[値]に設定した集計値
     - 分析内の[値の切り替え]や[軸の詳細情報]で追加した数式(使用中でないものも含む)

     なお、分析で使用している値には[使用中]のラベルが表示されます。\
     また、値名をクリックして以下の操作をおこなえます。
     - [値の設定]：\
       集計方法や表示に関する項目を設定できます。
     - [値の削除]：\
       [切り替える値]の一覧から、分析に使用していない値を削除できます。
   :::note{.hint}
   ヒント

   分析に使用している値のエラーにより要因ツリーが表示できない場合は、[値の設定]から設定を編集してエラーを解消すると分析を再開できます。
   :::
1. クリックすると、分析における詳細設定ができます。
   - リレーション設定:version[2.1.4]\
     分析に使用するリレーション設定を指定できます。\
     複数のリレーション設定を登録している場合のみ、表示されます。
   - 分析軸設定\
     分析軸に使用する項目を指定できます。\
     データセットの項目、セグメント、特徴量から指定することができます。
   - 集計設定\
     以下の項目を設定できます。
     - 件数の計算に使用するデータ
     - データ件数が少ない場合\
       しきい値以下のおすすめ分析軸や、ツリーに表示する項目を非表示にできます。しきい値には相対パーセント、または件数を指定できます。
     - 計算オプション\
       選択グループと比較グループの値の差について、比較方法を設定できます。
   - 表示設定\
     以下の項目を設定できます。
     - グラフ上にデータ数を表示する
     - マイナスを赤文字にする
     - 値の差と比率を両方表示する
     - 最大カード数\
       ツリー表示(項目番号16)において、各階層に表示する最大項目(カード)数を指定できます。\
       最大カード数は1～50の範囲で指定できます。
     - カードの表示幅:version[2.2.0]\
       ツリー表示(項目番号16)に表示するカードの幅を指定できます。\
       表示幅は200px～400pxの範囲で指定できます。
1. グループが表示されます。:version[2.4.0]\
   [+グループを追加]ボタン、または[編集]ボタンをクリックすると[グループ一覧]画面が表示され、分析に使用するグループを編集できます。
   - [+グループを追加]ボタンをクリックすると、一覧にグループを追加できます。\
     既存グループがある場合はグループ選択のメニューが表示されます。既存グループから選択、または[+ 新規グループ追加]ボタンをクリックして新規グループを設定してください。\
     なお、一覧に追加済みの既存グループを選択すると、選択したグループと同じ設定内容の新規グループを追加できます。\
     既存グループがない場合は[グループ設定]画面が表示されますので、画面に従って新規グループを設定してください。
   - グループをマウスオーバーすると、各グループに対して以下の操作をおこなえます。
     - [編集]ボタンをクリックすると、グループの編集や、別のグループとしての保存ができます。\
       グループに追加できる条件は、データセットの項目、セグメント、特徴量から指定可能です。
     - [グループ変更]ボタンをクリックすると、別のグループに入れ替えることができます。
     - [ごみ箱]ボタンをクリックすると、グループ一覧から削除できます。\
       なお、不要になったグループ設定は[グループ管理]画面から削除できます。\
       [グループ管理]画面は、[+グループを追加]ボタンをクリックし、[グループ管理]ボタンをクリックすると表示できます。
   - グループをドラッグ＆ドロップすると、順番を入れ替えることができます。
   - グループの左横にある色ラベルをクリックすると、グループの色を変更できます。\
     また、[色をデフォルト設定として保存]ボタンをクリックすると、現在の色をプロジェクトのデフォルト設定として保存できます。\
     保存したデフォルト設定は、[デフォルトの色を適用]ボタンをクリックすると適用できます。

   なお、マトリックスから遷移した場合は、マトリックスで使用しているグループが設定されます。
1. [+]ボタンをクリックしてフィルターを追加することにより、表示するデータを絞り込むことができます。:version[2.4.0]
   - 各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
   - フィルターの追加時に[すべてのタブに適用]にチェックを入れると、すべてのタブに適用するフィルターを追加することができます。:version[2.1.5]
   - フィルターの色によって、適用される範囲が異なります。:version[2.1.5]
     - 薄いグレー：すべてのタブに適用
     - 濃いグレー：各タブ内でのみ適用
   - フィルターをクリックすると、条件やフィルターの適用範囲を再設定することができます。:version[2.2.0]:version[2.3.0]\
     なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
     [フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。
   - 追加したフィルターを削除する場合は、フィルターをクリックして表示されるメニューの[フィルター削除]ボタンをクリックしてください。

   なお、マトリックスから遷移した場合は、マトリックスと同じ絞り込み条件が設定されており、条件を再設定することもできます。
   :::note{.hint}
   ヒント

   マトリックスの[値]欄の[表示設定]で[表示方法]に「行(列)総計に対する比率」を指定し、要因ツリーに遷移した場合は、 要因ツリーの[表示設定]の[表示方法]には「全総計に対する比率」が設定され、マトリックスで指定した範囲のみが要因ツリーの分析対象となるように自動でフィルターが追加されます。
   :::
1. 分析の説明が表示されます。:version[2.4.0]\
   クリックすると編集できます。
1. 設定した内容を元に集計された結果がグラフと数値で表示されます。
   - カードをクリックするとカードを選択できます。選択を解除する場合は、再度クリックしてください。
   - 一番深い階層のカードを選択すると[+]ボタンが右側に表示されます。:version[2.2.0]\
     [+]ボタンをクリックして分析軸を追加したり値を切り替えたりすることで、さらに階層を掘り下げて分析することができます。\
     階層を掘り下げると、指定した分析軸や切り替えた値を元に集計した結果がグラフと数値で表示されます。\
     [値の切り替え]タブでは、マトリックスで[値]に設定した集計値やプロジェクトに登録されている数式を複数選択して、分析する値をツリーの途中から別の値に切り替えることができます。
   - カードを右クリックすると左側のカードの折りたたみをおこなえます。:version[2.2.0]\
     折りたたんだカードはクリック、もしくは右クリックして展開できます。\
     また、[値の切り替え]タブで追加したカードはカードの折りたたみに加えて切り替えた値の書式設定もおこなえます。
1. クリックすると、分析軸を変更します。\
   表示される画面にて、変更する分析軸を指定してください。
1. 以下のいずれかの条件に合致する場合にボタンが表示されます。:version[2.1.5]
   - マトリックスで[値]を複数設定し、要因ツリーへ遷移した場合
   - 分析軸の値以外の数式がプロジェクトに登録されている場合

   ボタンをクリックして表示される[軸の詳細情報]画面では、マトリックスで[値]に設定している値やプロジェクトに登録されている数式を、分析軸の値と並べて表示することができます。
   - 値の並び順を変更する場合は、[:icon[/assets/img/common/icon-ascending-order.svg,昇順ソート]]/[:icon[/assets/img/common/icon-descending-order.svg,降順ソート]]ボタンをクリックしてください。:version[2.3.0]
   - 表示する値を追加する場合は、[+値の追加]ボタンをクリックしてください。
   - 追加した値の書式を設定する場合は、[設定]ボタンからおこなってください。
   - 追加した値を削除する場合は、[ごみ箱]ボタンをクリックしてください。
   - 表示されている内容をCSV形式でエクスポートする場合は、[エクスポート]ボタンをクリックしてください。
1. 分析軸のカードの並び順を変更できます。\
   ボタンをクリックして表示される候補から、並び替えの種類を指定してください。
1. クリックすると、分析軸を削除します。\
   分析軸を削除すると、削除した分析軸よりも下の階層が一段上がります。
1. 分析軸カードの並び順が表示されます。:version[2.1.5]\
   デフォルトの並び順から変更した場合にのみ表示され、クリックすると並び順を変更できます。
1. クリックすると、分析軸を左または、右に1階層分移動します。
1. 分析を複数のタブで管理できます。\
   作成した分析結果を元に分析軸を変えて深掘りしたい場合などに利用できます。\
   新規タブの追加は、[+]ボタンから、タブの名前変更や複製、削除は、タブ名右横の展開ボタンからおこなってください。
1. 項目番号16で選択したデータの説明が表示されます。:version[2.4.0]\
   また、[データ件数]のプルダウンにて、件数の計算に使用する分析用データを指定できます。\
   なお、[分析用データ表示]画面にて以下の操作が可能です。
     - 画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、表示するデータを一時的に絞り込むことができます。
       - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
       - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
         なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
       - フィルターをクリックすると、条件を再設定できます。\
         なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
       　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

       なお、変更したフィルター設定は、画面を閉じるとリセットされます。
   - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。:version[2.1.6]\
     再度ダブルクリックすると、固定が解除されます。
   - [リストビューを作成]ボタンをクリックすると、表示されているデータセットの内容でリストビューを作成できます。:version[2.3.0]
   - 表示されているデータセットの内容を[エクスポート]ボタンからエクスポートできます。:version[2.1.5]\
     出力する形式を以下のいずれかから選択し、必要項目を入力の上、[出力]ボタンをクリックしてください。

     | 出力形式                      | 設定内容                                                                                             |
     | ---------------------------- | ---------------------------------------------------------------------------------------------------- |
     | CSVファイル出力               | 出力するファイル名と区切り文字を指定します。                                                            |
     | データベースに出力            | データベースの接続情報と出力先のテーブルを指定します。                                                   |
     |                              | 設定方法の詳細は、「[各種データベースに出力](/guide/output-to-database/index.html)」を参照してください。 |
     | KI内のデータセットとして出力   | [新規作成]、または[既存データセットを上書き]のいずれかから選択します。                                   |
     |                              |  - [新規作成]を選択した場合：データセットの出力先を選択します。                                          |
     |                              |  - [既存データセットを上書き]を選択した場合：上書きするデータセットを選択します。                         |
