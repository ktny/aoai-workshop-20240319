---
title: ピボット
---
import Img from "../../components/Img.tsx";

データセットをピボットする方法について説明します。\
KIのピボットには、以下2つの機能があります。

## [集計しない]を選んだ場合

カテゴリデータを加工する機能です。\
機械学習の分析手法をおこなうためには、多くの場合、すべてのデータを数字で表現する必要があります。そのため、たとえばカテゴリデータを扱う場合には、分析前に数字への変換をおこないます。\
ただし、白→1、黒→2、赤→3のように変換してしまうと、黒は白と赤の中間などと解釈されてしまいます。\
そこで、白かどうかを表す列を新規作成し、白であれば1を入れることによって、すべてのカテゴリを等しく数字データに変換することができます。これは、一般的にワンホット表現と呼ばれる数字への変換方法です。\
\
例)\
以下の元データセットで「商品色」列をピボット列として実行した場合、ピボット実施結果として追加されるデータセットには、青枠で囲んだ列が展開されます。
<Img src="/assets/img/capture/capture-pivot-4.png" alt="元データセットとピボット実施結果" client:load />

## [集計する]を選んだ場合

データを任意の形式で分類し、集計する機能です。\
\
例)\
商品色ごとに在庫数の合計を集計する場合は、以下のようになります。
<Img src="/assets/img/capture/capture-pivot-5.png" alt="元データセットとピボット実施結果" client:load />

1. [プロジェクト詳細]画面から、画面左側の[ワークフロー]を選択します。
1. [ワークフロー]画面上で、ピボットを実施するデータセットを選択します。
1. [アクション]パネルに[ピボット]ボタンが表示されますのでクリックします。

   <Img src="/assets/img/capture/capture-pivot-1.png" alt="[ワークフロー]画面" client:load />

1. ピボットの設定をするパネルが表示されますので、各種設定をおこない[実行]ボタンをクリックします。\
   [ワークフロー]画面上に、集計した結果が新しいデータセットとして追加されます。
   ### [集計しない]を選択する場合
   <Img src="/assets/img/capture/capture-pivot-2.png" alt="[ワークフロー]画面" client:load />
   1. 編集内容の説明やメモを追加することができます。:version[2.4.0]\
      「http://」、または「https://」で始まる文字列はURLと認識され、リンクで表示されます。リンクは[Ctrl]キーを押しながらクリックし、表示される画面の[OK]ボタンをクリックすると開くことができます(別タブ表示)。\
      入力した内容を確定するには、入力欄からフォーカスをはずすか[Shift]+[Enter]キーを押してください。
   1. ピボット列(値の対象となる列)を指定します。
   1. [集計しない]を選択します。
   1. 新規列(項目番号2で指定したピボット列の展開先)に挿入される値を指定します。
      - [フラグ(1、または0)]を指定した場合：\
        レコード(行)ごとに、ピボット列の値と一致する場合は「1」、一致しない場合は「0」が入力されます。
      - [他の列の値]を指定した場合：\
        レコード(行)ごとに、ピボット列の値が一致する場合は、「1」のかわりに後述の項目番号5で指定した値、一致しない場合は「0」のかわりにNULLが入力されます。
   1. 新規列に入力する値をプルダウンから選択します。\
      この項目は、項目番号4で[他の列の値]を選択した場合のみ表示されます。
   1. 新規列(項目番号4)で指定した値について、上位何種類のデータを扱うかを1～500の範囲で指定します。\
      指定した値より多くの種類のデータがある場合は、それらのデータは1列にまとめて追加されます。(列名の末尾に「OTHERS」と名前が付きます)
   1. プレビューを表示できます。

   ### [集計する]を選択する場合
   <Img src="/assets/img/capture/capture-pivot-3.png" alt="[ワークフロー]画面" client:load />

   1. 編集内容の説明やメモを追加することができます。:version[2.4.0]\
      「http://」、または「https://」で始まる文字列はURLと認識され、リンクで表示されます。リンクは[Ctrl]キーを押しながらクリックし、表示される画面の[OK]ボタンをクリックすると開くことができます(別タブ表示)。\
      入力した内容を確定するには、入力欄からフォーカスをはずすか[Shift]+[Enter]キーを押してください。
   1. ピボット列(値の対象となる列)を指定します。
   1. [集計する]を選択します。
   1. グループ化する列をプルダウンから選択します。5つまで指定できます。\
      グループ化する列を指定しない場合は、すべての行を対象に集計します。
   1. 集計に用いる関数、および集計対象の列を指定します。複数列を指定できます。\
      指定できる関数については、後述の「[集計の種類](#集計の種類)」を参照してください。
   1. ピボット列について、何種類のデータを扱うかを1～500の範囲で指定します。\
      集計関数を複数指定した場合は、指定した範囲内で、ピボット列の一意なアイテム数×集計関数の数の列が新規に作成されます。
   1. チェックを入れた場合は、30,000行以上データがある場合も、全件のデータを用いて集計します。\
      チェックをはずした場合は、すべてのデータのうち、最大30,000件のデータを用いて集計します。
   1. プレビューを表示できます。

   ### 集計の種類
   | 関数                     | 対象のデータ型               | 説明                   |
   | ------------------------ | --------------------------- | --------------------- |
   | ANY                      | すべて                      | [対象]に指定した列について、[ピボット列]と対応しているデータ(NULLも含む)から任意の一つのデータを抽出します。 |
   | ANY NOT NULL             | すべて                      | [対象]に指定した列について、[ピボット列]と対応しているデータ(NULLを除く)から任意の一つのデータを抽出します。 |
   | AVERAGE                  | 整数型、小数型、論理型       | NULLを除いた数値データの平均値を算出します。 |
   | COUNT                    | すべて                      | [対象]に指定した列(NULLも含む)について、[ピボット列]と対応しているデータの個数(=行数)を算出します。 |
   | COUNT NOT NULL           | すべて                      | [対象]に指定した列(NULLを除く)について、[ピボット列]と対応しているデータの個数(=行数)を算出します。 |
   | COUNT DISTINCT           | すべて                      | NULLと重複を除いたデータの個数を算出します。 |
   | MAX                      | 文字列型、論理型以外         | データの最大値を出力します。 |
   | MIN                      | 文字列型、論理型以外         | データの最小値を出力します。 |
   | STDEV                    | 整数型、小数型               | NULLを除いた数値データの標準偏差を算出します。 |
   | SUM                      | 整数型、小数型、論理型       | NULLを除いた数値データの合計値を算出します。 |
   | VAR                      | 整数型、小数型               | NULLを除いた数値データの分散を算出します。 |
   | MEDIAN                   | 文字列型、論理型以外         | NULLを除いた数値データの中央値を算出します。 |

   :::note{.point}
   ポイント

   ピボットでできたデータセットの列数は、ピボットに使用したデータセットの更新により変更になる場合があります。\
   たとえば、ピボットに使用したデータセットが更新され、結果のデータセットの列構成が変化した場合、後段にAFEやデータ編集、集計があると、エラーになります。\
   その場合は処理アイコンから再編集を実行してください。
   - ピボット実施時
     <Img src="/assets/img/capture/capture-pivot-6.png" alt="データセットとピボットしたデータセット" client:load />
   - ピボット実施後にデータ更新された場合
     <Img src="/assets/img/capture/capture-pivot-7.png" alt="データセットとピボットしたデータセット" client:load />
     ※商品色データの構成が変わり、商品色-黒の列が消えてしまうため、後段のAFEなどがエラーになります。
   :::
