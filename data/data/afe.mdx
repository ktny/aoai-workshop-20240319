---
title: AFE
---
import Img from "../../components/Img.tsx";

AFEの分析方法について、説明します。

## 分析から作成

分析のメニューから作成するAFEには、以下のような機能があります。
- 目的変数の自動生成
- 元データを組み合わせて、さまざまな特徴量を自動生成
- 目的変数に対する特徴量の寄与度を算出
- 有用な特徴量を可視化
- 分析結果からターゲットリストの作成
- 分析結果の出力(セグメントへの追加や、分析用データへの特徴量追加)
- 指定したセグメントでシミュレーションの実行:version[2.1.5]

### AFEの作成

1. [プロジェクト詳細]画面から、画面左側の[分析]を選択します。
1. [分析]画面が表示されますので、[+分析を作成]ボタンをクリックします。
1. リレーションが設定されていないデータセットがある場合は、確認画面が表示されます。\
   表示される画面にて、[分析を作成]ボタンをクリックします。
1. [新規分析作成]画面が表示されますので、分析名を入力後、[分析種別]から[AFE]を選択して[作成]ボタンをクリックします。\
   :version[2.3.0]
1. [目的変数設定]画面が表示されますので、解決したい課題に応じて[分析の単位]、[目的変数]、目的変数の「最大化」/「最小化」を指定してください。
   - デフォルト以外のリレーション設定を使用する場合は、[リレーション設定]から選択してください。:version[2.1.4]
   - 目的変数/特徴量の集計期間が表示された場合は、集計期間を指定してください。
   - AFEの分析結果からターゲットリストを作成する場合は、目的変数に指定した値が2値(0/1、またはFalse/True)となる必要があります。\
     2値でない値の場合は、[目的変数のしきい値]が表示されますのでしきい値を指定してください。
   - 目的変数に「●●の合計値」、「●●の平均値」、「●●の個数」を指定した場合は、[目的変数の集計対象のフィルター]が表示され、目的変数の集計対象を絞り込むことができます。
   - 分析対象とするデータを絞り込む場合は、[分析対象のフィルター]から絞り込む条件を指定してください。

   設定が完了したら、[次へ]ボタンをクリックします。
1. [目的変数のプレビュー]画面が表示されますので、内容を確認します。\
   なお、[高度な設定]にて以下の項目を設定することができます。\
   また、設定した値を初期値としてプロジェクトに保存する場合は、[デフォルト設定として保存]ボタンをクリックしてください。
   - [特徴量に使用される列]：特徴量の生成に使用する列を指定できます。
   - [特徴量]：特徴量の生成に使用する項目を指定できます。
   - [出力する特徴量]：分析結果として表示する特徴量を「有効な特徴量のみ」とするか、「全ての特徴量」とするかを指定できます。
   - [インサイトの表示データ数]：インサイトの表示に用いるデータ数を指定できます。

   設定が完了したら、[実行]ボタンをクリックします。\
   AFEの実行中は、進捗が表示されます。AFEの完了には時間を要する場合があります。

### 分析結果の確認(分析から作成)

[分析]画面の一覧から、作成したAFEを選択して分析結果を確認できます。\
分析結果の画面は、[インサイト]タブ、[特徴量]タブ、[AFE結果]タブから構成しており、各タブにて分析結果の詳細を確認することができます。

#### 共通ヘッダー

共通して表示されるヘッダー項目について、説明します。

<Img src="/assets/img/capture/capture-afe-new-1.png" alt="AFE分析結果画面ヘッダー" client:load />

1. クリックすると、全画面表示に切り換わります。:version[2.4.0]\
   再度クリックすると、通常の画面表示に戻ります。\
   なお、全画面表示中のURLを他のユーザーに共有すると、そのURLを開いたユーザーも同様に全画面表示で閲覧することができます。
1. クリックすると、分析の名前を変更できます。
1. 信頼度を表示しています。\
   機械学習に基づく統計的な信頼度を示しています。星の数が多いほど信頼できる結果となります。
1. クリックすると、ブックマークに追加できます。:version[2.2.0]\
   ブックマークから削除する場合は、再度アイコンをクリックしてください。
1. クリックすると、分析の概要が表示されます。
1. データセットや分析を最新の内容に更新します。\
   ボタンをクリックして表示される画面から、更新対象を指定してください。
1. AFEの設定を編集して再度実行することができます。
1. クリックすると、保存した時点の内容に戻します。
1. クリックすると、設定した内容を保存します。
   - 右端の展開ボタンから[別名で保存]を選択すると、別名で保存することもできます。
   - 分析がロックされている場合は、[保存]ボタンは表示されず、[別名で保存]ボタンから別名保存のみ可能です。
1. クリックすると、特徴量一覧を開閉できます。\
   また、特徴量一覧にてカードをクリックすると、[1軸プロット]タブを表示します。\
   詳細については、後述の「[[1軸プロット]タブ](#1軸プロットタブ)」を参照してください。
1. [インサイト]タブを表示します。\
   [インサイト]タブでは、セグメントベースの特徴量の一覧が表示されます。\
   詳細については、後述の「[[インサイト]タブ](#インサイトタブ)」を参照してください。
1. [特徴量]タブを表示します。\
   [特徴量]タブでは、分析対象のデータ全体に対する特徴量が改善効果の大きい順に表示されます。\
   詳細については、後述の「[[特徴量]タブ](#特徴量タブ)」を参照してください。
1. [AFE結果]タブを表示します。:version[2.1.6]:version[2.4.0]\
   [AFE結果]タブでは、AFEの分析結果のデータが一覧表示されます。\
   一覧表示では、各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。\
   再度ダブルクリックすると、固定が解除されます。\
   目的変数設定の[分析の単位]にID列が設定されている場合は、行をダブルクリックすると、その行に関連した分析用データを確認することができます。\
   また、表示される[AFE計算元の分析用データ]画面にて以下の操作が可能です。
   - 画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、さらにデータを絞り込むことができます。
     - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
     - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
       なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
     - フィルターをクリックすると、条件を再設定できます。\
       なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
     　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

     なお、変更したフィルター設定は、画面を閉じるとリセットされます。
   - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。\
      再度ダブルクリックすると、固定が解除されます。
   - 表示されているデータセットの内容を[エクスポート]ボタンからCSVファイル(ZIP圧縮)にてエクスポートできます。
1. セグメント種別を切り換えることができます。(目的変数を指定している場合のみ)
   - [要改善]を選択した場合：\
     目的変数の設定時に「最大化」を選択した場合は、目的変数の数値が 低い順に、「最小化」を選択した場合は、目的変数の数値が高い順に表示します。
   - [優良層]を選択した場合：\
     目的変数の設定時に「最大化」を選択した場合は、目的変数の数値が 高い順に、「最小化」を選択した場合は、目的変数の数値が低い順に表示します。
1. クリックして表示される画面にて、分析結果に表示する特徴量を指定できます。
1. クリックすると、一覧に表示するデータの絞り込みができます。\
   なお、フィルターを追加してもセグメントの特徴量の境界値は変化しません。\
   フィルターを解除する場合は、フィルターアイコンの[×]ボタンをクリックしてください。
1. 画面に表示している一覧をCSVファイルにエクスポートします。

#### [インサイト]タブ

[インサイト]タブは、目的変数を指定している場合に表示され、セグメント(細分化したグループ)ごとにどれくらい平均より優れているのかを確認することができます。

<Img src="/assets/img/capture/capture-afe-new-2.png" alt="AFE分析結果画面[インサイト]タブ" client:load />

1. チェックを入れると、画面下部に操作メニューが表示され、セグメントの出力やターゲットリストの作成をおこなうことができます。\
   複数指定する場合は、1つ目のカードにチェックを入れると、2つ目以降はカード自体をクリックして指定することができます。\
   すべてのカードを選択する場合は、一覧上部の[すべてチェック]にチェックを入れてください。
1. セグメントの説明を表示しています。AFEにて自動生成された特徴量には[AFE]ラベルが表示されます。\
   カードをクリックすると、[1軸プロット]タブが表示されます。\
   詳細については、後述の「[[1軸プロット]タブ](#1軸プロットタブ)」を参照してください。
1. 目的変数の平均値を表示しています。
   - [セグメント種別]で[要改善]を選択している場合：\
     このセグメントに現実的な範囲で施策を打ったときの目的変数の平均値を表示しています。
   - [セグメント種別]で[優良層]を選択している場合：\
     このセグメントにおける目的変数の平均と、全体平均との差分が表示されます。
1. クリックすると、2軸目(項目番号6)が表示されセグメントの条件を追加できます。
1. クリックすると、2軸目のセグメントの条件を切り換えることができます。
1. セグメント(項目番号2)に対して、2軸目となるセグメントの条件を表示します。AFEにて自動生成された特徴量には[AFE]ラベルが表示されます。\
   構成比、および改善効果は2つの特徴量のAND条件で絞ったセグメントの結果となっています。\
   カードをクリックすると、[クロス集計]タブが表示されます。\
   [クロス集計]タブの詳細については、「[[クロス集計]タブ](#クロス集計タブ)」を参照してください。
1. クリックすると、操作をキャンセルし、チェックボックスのチェックがクリアされます。
1. チェックを入れたセグメントを出力します。\
   出力方法は、「セグメント一覧に追加」、「CSVファイル出力」、「データセットとして出力」のいずれかを指定できます。\
   なお、「セグメント一覧に追加」において、セグメントに使用している特徴量をデータセットに追加できます。追加する特徴量の集計期間を自動で最新化したい場合は、[タイムシフト特徴量として出力]にチェックを入れてください。
1. チェックを入れたセグメントでターゲットリストを作成します。\
   表示される画面に沿って、スコアリング設定、予測の基準日(設定が必要な場合のみ表示されます)を指定してください。\
   その他の設定については、指定したセグメントから自動で設定されます。\
   ターゲットリストについては、「[ターゲットリスト](/guide/target-list/index.html)」を参照してください。

#### [特徴量]タブ

[特徴量]タブでは、特徴量が改善効果の大きい順で表示されます。\
対象となるセグメントはデータ全体となります。フィルターを設定した場合は、フィルターしたデータが対象となります。

<Img src="/assets/img/capture/capture-afe-new-3.png" alt="AFE分析結果画面[特徴量]タブ" client:load />

1. チェックを入れると、画面下部に操作メニューが表示され、特徴量を出力できます。\
   なお、複数指定する場合は、1つ目のカードにチェックを入れると、2つ目以降はカード自体をクリックして指定することができます。\
   すべてのカードを選択する場合は、一覧上部の[すべてチェック]にチェックを入れてください。
1. 特徴量の説明を表示しています。AFEにて自動生成された特徴量には[AFE]ラベルが表示されます。\
   カードをクリックすると、[1軸プロット]タブが表示されます。\
   詳細については、後述の「[[1軸プロット]タブ](#1軸プロットタブ)」を参照してください。
1. 特徴量の変化量を表示しています。データ全体に対して、特徴量を中央値付近で10パーセンタイル分動かしたときの変化量を意味しています。\
   なお、目的変数を指定していない場合は「-」が表示されます。
1. 特徴量の改善効果を表示しています。\
   分析対象となるデータ全体に対して、左側に書かれた特徴量を中央値付近で特徴量の変化量分だけ変更し、シミュレーションしたときの改善効果を示しています。\
   なお、目的変数を指定していない場合は「-」が表示されます。
1. クリックすると、操作をキャンセルし、チェックボックスのチェックがクリアされます。
1. チェックを入れた特徴量を出力します。\
   出力方法は、「分析用データに追加」、「CSVファイル出力」、「データセットとして出力」のいずれかを指定できます。\
   なお、「分析用データに追加」において、特徴量の集計期間を自動で最新化したい場合は、[タイムシフト特徴量として出力]にチェックを入れてください。

#### [1軸プロット]タブ

[1軸プロット]タブでは、特徴量と目的変数の関係をグラフで表示します。\
目的変数を指定していない場合は、特徴量のカウント(データ数)がグラフで表示されます。

<Img src="/assets/img/capture/capture-afe-new-4.png" alt="AFE分析結果画面[1軸プロット]タブ" client:load />

1. クリックすると、1つ前の画面に戻ります。
1. クリックすると、[クロス集計]タブが表示されます。\
   [クロス集計]タブの詳細については、「[[クロス集計]タブ](#クロス集計タブ)」を参照してください。
1. 横軸に特徴量、縦軸に目的変数とデータカウント数を示したグラフを表示します。全体の傾向の把握、注目するセグメントの確認ができます。\
   なお、特徴量のみ生成している場合は、目的変数の表示はありません。
   - 横軸の特徴量は一定間隔で区切られており、その区間における目的変数の平均(上縦軸)とデータカウント数(下縦軸)を表示しています。
   - グラフ上で範囲選択すると、その範囲をセグメントとすることができ、分析結果の絞り込みにも使用できます。\
     [Shift]キー+左クリックで連続した部分を複数選択できます。
   - 横軸がカテゴリ型の場合は、[Ctrl]キー(Mac OSの場合は[Command⌘]キー)+左クリックでとびとびの範囲を指定することもできます。:version[2.1.6]
   - グラフ下部にスライダーが表示される場合は、スライダーを操作して表示する範囲を変更できます。
1. クリックすると、表示するデータの絞り込みができます。\
   フィルターを解除する場合は、フィルターアイコンの[×]ボタンをクリックしてください。
1. プロットで使用しているデータをCSVファイルでエクスポートします。
1. クリックすると画面右側の説明領域の表示/非表示を切り換えることができます。
1. グラフで選択しているセグメントの説明が表示されます。\
   [編集]ボタンをクリックすると、セグメントの条件を変更できます。
1. 目的変数を指定している場合は、[+インサイトに追加]ボタンが表示され、表示しているセグメントをインサイトの一覧に追加できます。
1. 選択されているセグメントの全体に対する割合(構成比)と、選択セグメントにおける目的変数の平均値(目的変数を指定している場合のみ)を表示しています。
1. クリックして表示される[セグメントの内容]画面にて、選択されているセグメントのデータを確認することができます。\
   また[セグメントの内容]画面では、以下の操作が可能です。
   - [比較テーブル]タブと[プレビュー]タブを切り換えて表示できます。
   - [比較テーブル]タブでは、選択中のセグメントと「その他」(セグメント外)か「すべてのデータ」で特徴量の値を比較できます。:version[2.1.5]\
     比較テーブルには、デフォルトで最大10個の特徴量が比較した差の大きい順で表示されます。\
     すべての特徴量を表示したい場合は、比較テーブルの右下にある[すべて表示]ボタンをクリックしてください。
   - [プレビュー]タブでは、データのプレビューが表示されます。:version[2.1.6]:version[2.4.0]\
     表示されている内容は、[エクスポート]ボタンからCSVファイルでダウンロードすることも可能です。\
     各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。\
     再度ダブルクリックすると、固定が解除されます。\
     目的変数設定の[分析の単位]にID列が設定されている場合は、行をダブルクリックすると、その行に関連した分析用データを確認することができます。\
     また、表示される[AFE計算元の分析用データ]画面にて以下の操作が可能です。
     - 表示された画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、さらにデータを絞り込むことができます。
       - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
       - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
         なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
       - フィルターをクリックすると、条件を再設定できます。\
         なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
       　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

       なお、変更したフィルター設定は、画面を閉じるとリセットされます。
     - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。\
       再度ダブルクリックすると、固定が解除されます。
     - 表示されているデータセットの内容を[エクスポート]ボタンからCSVファイル(ZIP圧縮)にてエクスポートできます。
1. 選択したセグメントに対するシミュレーションをおこないます。:version[2.1.5]\
   シミュレーション結果の見方は、「[シミュレーション結果の確認](#シミュレーション結果の確認)」を参照してください。

#### [クロス集計]タブ

[クロス集計]タブでは、2つの特徴量を掛け合わせて目的変数との関係を表示します。\
目的変数を指定していない場合は、2つの特徴量をかけ合わせた集計を表示します。

<Img src="/assets/img/capture/capture-afe-new-5.png" alt="AFE分析結果画面[クロス集計]タブ" client:load />

1. クリックすると、1つ前の画面に戻ります。
1. クリックすると、[1軸プロット]タブが表示されます。\
   [1軸プロット]タブの詳細については、「[[1軸プロット]タブ](#1軸プロットタブ)」を参照してください。
1. クロス集計表が表示されます。
   - 縦軸、横軸ともにプルダウンから特徴量を変更できます。
   - 展開ボタンから表示するデータの範囲を切り換えることができます。
   - グラフ上で複数選択([Shift]キー+左クリック)することで、その範囲に含まれるデータをセグメントとすることができます。
1. クリックすると、表示するデータの絞り込みができます。\
   フィルターを解除する場合は、フィルターアイコンの[×]ボタンをクリックしてください。
1. クロス集計テーブルをCSVファイルでエクスポートします。
1. 目的変数を指定している場合は、クロス集計テーブルで集計する項目を指定できます。[目的変数]か、[カウント&#093;(データ数)を指定してください。
1. クリックすると画面右側の説明領域の表示/非表示を切り換えることができます。
1. グラフで選択しているセグメントの説明が表示されます。\
   [編集]ボタンをクリックすると、セグメントの条件を変更できます。
1. 目的変数を指定している場合は、[+インサイトに追加]ボタンが表示され、セグメントとして追加できます。\
   追加されたセグメントは、[セグメント]タブのトップに表示されます。
1. 選択されているセグメントの全体に対する割合(構成比)と、選択セグメントにおける目的変数の平均値を表示(目的変数を指定している場合のみ)しています。
1. クリックして表示される[セグメントの内容]画面にて、選択されているセグメントのデータを確認することができます。\
   また[セグメントの内容]画面では、以下の操作が可能です。
   - [比較テーブル]タブと[プレビュー]タブを切り換えて表示できます。
   - [比較テーブル]タブでは、選択中のセグメントと「その他」(セグメント外)か「すべてのデータ」で特徴量の値を比較できます。:version[2.1.5]\
     比較テーブルには、デフォルトで最大10個の特徴量が比較した差の大きい順で表示されます。\
     すべての特徴量を表示したい場合は、比較テーブルの右下にある[すべて表示]ボタンをクリックしてください。
   - [プレビュー]タブでは、データのプレビューが表示されます。:version[2.1.6]:version[2.4.0]\
     表示されている内容は、[エクスポート]ボタンからCSVファイルでダウンロードすることも可能です。\
     各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。\
     再度ダブルクリックすると、固定が解除されます。\
     目的変数設定の[分析の単位]にID列が設定されている場合は、行をダブルクリックすると、その行に関連した分析用データを確認することができます。\
     また、表示される[AFE計算元の分析用データ]画面にて以下の操作が可能です。
     - 表示された画面上部の[+]ボタンをクリックするか項目の値をダブルクリックしてフィルターを追加すると、さらにデータを絞り込むことができます。
       - 追加した各フィルターの先頭に付いている丸いチェックボックスで、フィルターの有効/無効を切り換えることができます。
       - 追加したフィルターを削除する場合は、フィルターをクリックすると表示されるメニューの[フィルター削除]ボタンをクリックしてください。\
         なお、項目の値をダブルクリックして追加したフィルターであれば、再度同じ値をダブルクリックすることでも削除できます。
       - フィルターをクリックすると、条件を再設定できます。\
         なお、閲覧するユーザーに応じて関連するデータで絞り込みたい場合は、[列]にデータ型が文字列型の列を指定し、条件のプルダウンから「現在のユーザーIDと一致」を選択してください。\
       　[フィルターを適用するユーザー]でユーザー、およびユーザーグループを指定すると、特定のユーザーにのみフィルターを適用できます(指定外のユーザーにはフィルターが無効になります)。

       なお、変更したフィルター設定は、画面を閉じるとリセットされます。
     - 各列のヘッダーをダブルクリックすることで、列をテーブルの左側に固定することができます(複数列可)。\
       再度ダブルクリックすると、固定が解除されます。
     - 表示されているデータセットの内容を[エクスポート]ボタンからCSVファイル(ZIP圧縮)にてエクスポートできます。
1. 選択したセグメントに対するシミュレーションをおこないます。:version[2.1.5]\
   シミュレーション結果の見方は、「[シミュレーション結果の確認](#シミュレーション結果の確認)」を参照してください。

### シミュレーション結果の確認
:version[2.1.5]

指定されたセグメントに対して特徴量を変更したときの効果(目的変数の変化)を表示します。

<Img src="/assets/img/capture/capture-afe-new-6.png" alt="シミュレーション結果画面" client:load />

1. 選択したセグメントが表示されます。
1. 特徴量の値を変化させます。\
   各項目は、数値入力、またはスライドバーで設定できます。
   - その特徴量を変化させた場合に、目的変数にどの程度の影響があるかをバーの色で表しています。\
     青色は、目的変数が改善する方向を示します。色が濃いほど改善効果が高くなります。\
     グレーは、目的変数が悪くなる方向を示します。色が濃いほどマイナス効果が高くなります。\
     あまり実データがない極端な値を指定した場合は、スライドバー左横に「上位N％」、「下位N％」と表示されます。
   - 数値型のパラメータの場合は選択セグメントの平均値が表示されます。シミュレーションすると、加えた変化量をすべてのデータに加減算します。
   - カテゴリ型のパラメータの場合は、カテゴリ名とそのカテゴリが占める割合が表示されます。割合を変更してシミュレーションすると、そのカテゴリ以外の割合は均等に加減算されます。
   - 特徴量にマウスカーソルを合わせると特徴量名全体が表示されます。
1. クリックすると、特徴量を削除できます。
1. クリックすると、特徴量を追加できます。
1. シミュレーション結果の内容が表示されます。

## ワークフローから作成

ワークフローからおこなうAFEには、以下のような機能があります。

- 目的変数の自動生成
- 元データを組み合わせて、さまざまな特徴量を自動生成
- 目的変数に対する特徴量の寄与度を算出
- 有用な特徴量を可視化
- シミュレーション機能
- ターゲット機能

### 目的変数の設定と特徴量の生成

1. [プロジェクト詳細]画面から、画面左側の[ワークフロー]を選択します。
1. [フロー]パネル上(青枠部分)で分析に使用するデータセットを選択後、[AFE]ボタンをクリックします。

   <Img src="/assets/img/capture/capture-analyze-1.png" alt="ワークフロー画面" client:load />

   :::note{.hint}
   ヒント

   - [Shift]や[Ctrl]キーを押しながらクリックすると、データセットを複数選択できます。
   - [ワークフロー]画面の詳細は、「[ワークフロー画面](/guide/project-details/index.html#ワークフロー画面)」を参照してください。
   :::

1. [アクション]パネル(青枠部分)の表示が切り換わりますので、[AFE設定]ボタンをクリックします。

   <Img src="/assets/img/capture/capture-analyze-2.png" alt="ワークフロー画面" client:load />

   :::note{.hint}
   ヒント

   [アクション]パネルには、分析対象に指定したデータセットが緑色でハイライト表示されます。\
   クリックすると、分析対象のデータセットを増やすことができます。
   :::

1. [AFE - ①リレーションの設定]画面が表示されますので、データセット間の関連付け(共通キー)をプルダウンから選択して、[次へ]ボタンをクリックします。

   :::note{.hint}
   ヒント

   分析対象に指定したデータセットが3つ以上の場合は、[リレーションを追加]ボタンをクリックして、別テーブル間のリレーションを追加できます。
   :::

1. [AFE - ②目的変数設定]画面が表示されますので、目的変数(解決したい課題)を設定後、[次へ]ボタンをクリックします。

   <Img src="/assets/img/capture/capture-analyze-4.png" alt="AFEリレーション設定画面2" client:load />

   1. 分析の単位を選択します。
   1. 目的変数の候補が自動生成されますので、解決したい課題に適するものを選択します。\
      目的変数を設定しない場合は、「特徴量自動生成」を選択します。
   1. 項目番号2で目的変数を設定した場合は、目的変数を最大化したいか、最小化したいかのいずれかを選択します。
   1. 項目番号2で「●●がしきい値より大きくなる割合」、「●●がしきい値より小さくなる割合」を選択した場合は、しきい値を設定します。
   1. 分析の名前を付けることができます。ここで付けた名前がAFEの分析名として表示されます。
   1. 項目番号2で集計値(●●ごとの合計など)を選択した場合、かつ集計対象のデータセットに時系列データが含まれる場合は、目的変数の集計期間を設定することができます。\
      また、項目番号2で「特徴量自動生成」を選択した場合、かつ日時型や日付型のイベント列がある場合は、イベント日付までのデータを使って、特徴量を生成することができます。\
      設定の詳細は、後述の「[特徴量と目的変数の集計に使用する期間](#特徴量と目的変数の集計に使用する期間)」を参照してください。
   1. チェックを入れると、指定したデータを時系列データと見なして分析します。\
      時系列データに指定すると、日付の前後関係を踏まえた分析をすることができます。
   1. 特定の期間の時系列データから特徴量を生成したい場合は、開始日と終了日を指定します。\
      設定方法の詳細は、後述の「[特徴量と目的変数の集計に使用する期間](#特徴量と目的変数の集計に使用する期間)」を参照してください。
   1. 項目番号2で集計値(●●ごとの合計など)を選択して、この項目にチェックを入れた場合、集計対象のレコードをフィルターすることができます。文字列型のデータを使って、5つまで条件を指定できます。

   #### 特徴量と目的変数の集計に使用する期間

   〇〇ごとの△△と表現されるような、時系列データを集計した目的変数を選択した場合は、時系列データのどの期間から目的変数、特徴量を生成するかを設定することができます。

   | 目的変数生成期間の指定                      | 説明と設定方法                                                                                                                    |
   | ------------------------------------------  | ----------------------------------------------------------------------------------------------------------------------------------|
   | 集約日数を指定                              | ＜説明＞                                                                                                                          |
   |                                             | 集計対象となる時系列データの、最終日から逆算したN日間のデータから、目的変数を生成します。                                         |
   |                                             | 特徴量の生成には、目的変数生成に使用した期間のデータは使用しません。                                                              |
   |                                             | これにより、リークが起こりにくくなります。                                                                                        |
   |                                             | <Img src="/assets/img/capture/capture-analyze-12.png" alt="集約日数を指定" client:load />                                                                     |
   |                                             | <Img src="/assets/img/capture/fig-feature-1.png" alt="集約日数を指定" client:load />                                                                          |
   |                                             | ＜[期間]の設定方法＞                                                                                                              |
   |                                             | プルダウンから日数を指定します。                                                                                                  |
   | 全て                                        | ＜説明＞                                                                                                                          |
   |                                             | 時系列データの全期間、全データで目的変数と特徴量を生成します。                                                                    |
   |                                             | リークが起こりやすく、注意が必要です。                                                                                            |
   |                                             | <Img src="/assets/img/capture/capture-analyze-13.png" alt="全て" client:load />                                                                               |
   |                                             | <Img src="/assets/img/capture/fig-feature-3.png" alt="全て" client:load />                                                                                    |
   |                                             | ＜[期間]の設定方法＞                                                                                                              |
   |                                             | プルダウンから「全て」を指定します。                                                                                              |
   | 集約日数を指定(高度な設定)                  | ＜説明＞                                                                                                                          |
   |                                             | 期間の開始日と終了日を指定して目的変数を生成します。                                                                              |
   |                                             | なお、特徴量の生成には、目的変数生成に使用した期間のデータは使用しません。                                                        |
   |                                             | これにより、リークが起こりにくくなります。                                                                                        |
   |                                             | <Img src="/assets/img/capture/capture-analyze-14.png" alt="集約日数を指定" client:load />                                                                     |
   |                                             | <Img src="/assets/img/capture/fig-feature-5.png" alt="集約日数を指定" client:load />                                                                          |
   |                                             | ＜[期間]の設定方法＞                                                                                                              |
   |                                             | 以下のとおり指定します。                                                                                                          |
   |                                             | - [期間]：「高度な設定・・・」を選択                                                                                              |
   |                                             | - [集計オプション]：「集約期間を指定」を選択                                                                                      |
   |                                             | - [開始日]、[終了日]：集計に用いる日付を指定                                                                                      |
   | 指定したイベントからN日間を集約(高度な設定) | ＜説明＞                                                                                                                          |
   |                                             | マスターごとに日時型、日付型のイベント列を指定して、その日付以降のN日間で目的変数を、その日付以前のデータから特徴量を生成します。 |
   |                                             | これにより、データごとに分析期間を細かく設定できます。                                                                            |
   |                                             | イベント列は、マスターに存在する必要があります。                                                                                  |
   |                                             | (マスターとは、分析の名前の冒頭に表示されるデータセットです)                                                                      |
   |                                             | <Img src="/assets/img/capture/capture-analyze-15.png" alt="指定したイベントからN日間を集約" client:load />                                                    |
   |                                             | <Img src="/assets/img/capture/fig-feature-7.png" alt="指定したイベントからN日間を集約" client:load />                                                         |
   |                                             | ＜[期間]の設定方法＞                                                                                                              |
   |                                             | 以下のとおり指定してください。                                                                                                    |
   |                                             | - [期間]：「高度な設定・・・」を選択                                                                                              |
   |                                             | - [集計オプション]：「指定したイベントからN日間を集約」を選択                                                                     |
   |                                             | - [イベント列]：集計期間の起点となる列を指定                                                                                      |
   |                                             | - [期間]：集計に用いる期間を日数で指定                                                                                            |
   :::note{.hint}
   ヒント

   特徴量と目的変数の生成に用いるデータ期間については、次画面の[時系列データ]にて、確認することができます。
   :::

   マスターにある項目を目的変数とする場合や、特徴量自動生成をする場合

   マスターに日時型、日付型のイベント列がある場合は、イベント日付までのデータを使って、特徴量を生成することができます。
   | 特徴量生成期間の指定                       | 説明と設定方法                                                                 |
   | ------------------------------------------ | -------------------------------------------------------------------------------|
   | イベントまでのデータで分析する(高度な設定) | ＜説明＞                                                                       |
   |                                            | 日時型、日付型のイベント列を指定して、その日付までの期間で特徴量を生成します。 |
   |                                            | イベント列は、マスターに存在する必要があります。                               |
   |                                            | <Img src="/assets/img/capture/capture-analyze-16.png" alt="イベントまでのデータで分析する" client:load />  |
   |                                            | <Img src="/assets/img/capture/fig-feature-9.png" alt="イベントまでのデータで分析する" client:load />       |
   |                                            | ＜[期間]の設定方法＞                                                           |
   |                                            | 以下のとおり指定してください。                                                 |
   |                                            | - [集計オプション]：「イベントまでのデータで分析する」を選択                   |
   |                                            | - [イベント列]：集計期間の起点となる列を指定                                   |
   | なし                                       | ＜説明＞                                                                       |
   |                                            | 全データで特徴量を生成します。                                                 |
   |                                            | <Img src="/assets/img/capture/capture-analyze-17.png" alt="なし" client:load />                            |
   |                                            | <Img src="/assets/img/capture/fig-feature-11.png" alt="なし" client:load />                                |
   |                                            | ＜[期間]の設定方法＞                                                           |
   |                                            | 以下のとおり指定してください。                                                 |
   |                                            | - [集計オプション]：「なし」を選択                                             |

1. [AFE - ③目的変数のプレビュー]画面が表示されますので、内容を確認後[実行]ボタンをクリックします。

   <Img src="/assets/img/capture/capture-analyze-5_1.png" alt="AFEリレーション設定画面3" client:load />

   1. 目的変数のプレビューが表示されます。\
      データ件数が30,000件を超えている場合は、30,000件にサンプリングされて表示されます。すべてのデータを使用してプレビューしたい場合は、[全データで再計算]ボタンをクリックしてください。\
      なお、[AFE - ②目的変数設定]画面の[分析の目的]にて、「特徴量自動生成」を選択した場合、プレビューは表示されません。
   1. 時系列データを使用している場合、どの期間のデータセットを使って、目的変数、および特徴量を生成しているかが表示されます。\
      線の色の意味は、以下のとおりです。
      - 目的変数生成期間：黄緑
      - 特徴量生成期間：緑
      - 使用していない期間：グレー

   <Img src="/assets/img/capture/capture-analyze-5_2.png" alt="AFEリレーション設定画面3" client:load />

   3) [標準]タブ、[カスタム1]タブ、[カスタム2]タブから、特徴量生成に用いる関数を設定できます。
      - [標準]タブ：\
        全体に対して特徴量を適用したい場合に使用します。
      - [カスタム1]タブ：\
        ビジネス的な観点で重要と考えられる変数に対して、特徴量を個別に設定したい場合に使用します。適用する列は5つまで指定できます。
      - [カスタム2]タブ：\
        [カスタム1]タブと同様です。
   4) 特徴量生成に用いる項目のチェックボックスにチェックを入れてください。

   <Img src="/assets/img/capture/capture-analyze-5_3.png" alt="AFEリレーション設定画面3" client:load />

   5) マスターとなるデータセットに、何段階までデータセットをつなげて特徴量を生成するかを設定できます。
   6) 分析結果に反映する特徴量について、以下のいずれかをプルダウンから選択します。
      - 有効な特徴量のみ
      - 有効な特徴量+指定した列
      - 利用可能な全ての特徴量

      なお、[AFE - ②目的変数設定]画面にて、集約ありの目的変数を選択した場合は、「有効な特徴量+指定した列」は表示されません。\
      また、[AFE - ②目的変数設定]画面の[分析の目的]にて、「特徴量自動生成」を選択した場合は、「利用可能な全ての特徴量」が自動入力されます。
   7) 項目番号6で「有効な特徴量+指定した列」を選択した場合に表示されます。列名を3つまで指定できます。\
      ここで指定された変数は、特徴量の選択に関係なく、モデル変数として採用されAFE結果に反映されます。
   8) 分析結果([分析の名前])画面でのインサイトの表示に用いるデータ数を指定します。(100～1000000)\
      指定したデータ数が多い場合は、より細かいセグメントまで正確な値が取得できるようになりますが、表示やシミュレーションに時間を要します。\
      なお、後述するセグメントのエクスポートや、[ワークフロー]画面でのデータセット出力については、常に全件のデータを使用します。\
      また、[AFE - ②目的変数設定]画面の[分析の目的]にて、「特徴量自動生成」を選択した場合は、0が自動入力されます。
   9) AFEを実行した結果のデータセット上の列名について、プルダウンから表示形式を選択します。
      - 自然言語を選択した場合、一般的な言葉で表示されます。\
        例)\
        列名が”デモ件数”の場合、「デモ件数の合計値」となります。
      - 数値形式を選択した場合、数式で表示されます。\
        例)\
        データセット名が”Dataset02”、列名が”デモ件数”の場合、「Dataset02.デモ件数 - SUM」となります。

   AFEの実行中は、分析結果([分析の名前])画面に進捗が表示されます。\
   特徴量が生成され、特徴量の一覧、および説明が表示されます。
   AFEの完了には時間を要する場合があります。

   <Img src="/assets/img/capture/capture-analyze-6.png" alt="分析結果([分析の名前])画面" client:load />

#### 生成される特徴量

KIでは、合計や曜日など、さまざまな種類の特徴量を元データから生成することができます。特徴量には、大きく分けて以下の2つの種類があります。

| 種類  | 説明                                                   |
| ---- | -------------------------------------------------------|
| 変換 | あるデータセットの列を変換して、新しい列を生成します。     |
|      | 例)曜日                                                |
|      | <Img src="/assets/img/capture/capture-analyze-18.png" alt="変換" client:load />    |
| 集約 | あるデータセットの列をグループごとに集計して、別のデータセットに結合します。 |
|      | どのようなグループで集計するか(集計の単位)は、設定したリレーションによって決められます。 |
|      | 例)顧客マスタと購買トランザクションをID列を使ってつなげた場合、顧客マスタのそれぞれの列に対して、IDごとの合計値が計算されます。 |
|      | <Img src="/assets/img/capture/capture-analyze-19.png" alt="変換" client:load />    |

AFEでは、複数の特徴量の組み合わせも生成します。たとえば、「曜日」(変換)と「個数」(集約)を組み合わせて、「月曜日の購買データの数」という特徴量が自動的に生成されます。

##### ＜数値、カテゴリの特徴量＞

| 名前 | 種類 | 内容 | 特徴量の例 |
| ---- | ---- | ---- | ---------- |
| 合計 | 集約 | グループごとの合計値を集計します。 | 顧客ごとの合計売上高 |
| 平均 | 集約 | グループごとの平均値を集計します。 | 平均購入単価 |
| 最小 | 集約 | グループごとの最小値を集計します。 | 最短訪問時間や最小購入額 |
| 最大 | 集約 | グループごとの最大値を集計します。 | 過去の最大利用額 |
| 個数 | 集約 | グループごとの行の数を集計します。値が欠損している行はカウントされません。 | 総購買回数 |
| 最頻値 | 集約 | グループごとにもっとも頻度が高い値を集計します。 | 一番よく買う商品 |
| 最初の値 | 集約 | グループごとに時間順で最初の行の値を抽出します。時系列データに対してのみ計算されます。 | 最初にアクセスしたWebページの種類 |
| 最後の値 | 集約 | グループごとに時間順で最後の行の値を抽出します。時系列データに対してのみ計算されます。 | 最後にコンタクトした営業担当者 |
| 割合 | 集約 | グループごとに値が1、またはTrueとなっている行の割合を集計します。 | クーポン利用の割合 |
| 重複を除いた個数:version[2.1.4] | 集約 | グループごとに重複を除いた数を抽出します。 | 訪問したWebページの種類 |
| 平均からの差 | 変換 | ある列のカテゴリごとに平均値を計算し、元の値と平均値との差を計算します。 | 商品カテゴリごとの平均購買額からの差(同じ商品カテゴリ内での相対購買額の多寡) |
| + | 変換 | 2つの数値の和を計算します。 | 2つの検査工程でかかった時間の和 |
| - | 変換 | 2つの数値の差を計算します。 | 買取価格と販売価格の差 |
| × | 変換 | 2つの数値の積を計算します。 | 購入数×単価 |
| ÷ | 変換 | 2つの数値の商を計算します。分母が0以下の場合は、結果はNULLとなります。 | ローン申し込み額と収入の比率 |
| カテゴリごとの合計 | 集約 | グループごとの合計値を、ある列のカテゴリそれぞれに対して集計します。 | 支払方法ごとの合計支払額 |


##### ＜日付/時間の特徴量＞

| 名前 | 種類 | 内容 | 特徴量の例 |
| ---- | ---- | ---- | ---------- |
| 年 | 変換 | 日付/日時から年の値を抽出します。 | 売上年 |
| 月 | 変換 | 日付/日時から月の値を抽出します。 | アプリインストール月 |
| 日 | 変換 | 日付/日時から日の値を抽出します。 | 口座引き落とし日 |
| 時 | 変換 | 日時/時間から時間の値を抽出します。 | 製造開始時間 |
| 平日 | 変換 | 日付/日時が平日(月曜日～金曜日)かどうかを抽出します。 | 申し込み日が平日かどうか |
| 土日 | 変換 | 日付/日時が土日かどうかを抽出します。 | 売上日が土日かどうか |
| 曜日 | 変換 | 日付/日時から曜日の値を抽出します。 | DM送付の曜日 |
| 日付の差 | 変換 | 1つのデータセットの中の2つの日付列/日時列の日付の差を計算します。 | 資料ダウンロード日から初回商談日までの経過日数 |
| 最終日からの経過日数 | 集約 | グループごとの最終トランザクションの日付と、トランザクションデータ全体の最終日との差を計算します。時系列データに対してのみ計算されます。 | 最終来店日からの経過日数 |
| 1日あたりのトランザクション数 | 集約 | グループごとに、日付の種類数とデータの行数との比率を計算します。時系列データに対してのみ計算されます。 | 1日の来店あたりの平均購入品目数 |
| 継続日数 | 集約 | グループごとに、一番古い日付と一番新しい日付の差の日数を計算します。時系列データに対してのみ計算されます。 | 初回購買から最新の購買までの日数 |
| 前回のトランザクションからの日数 | 変換 | グループごとに、1つ前の日付からの差を計算します。時系列データに対してのみ計算されます。 | 前回の購買からの日数 |
| 時間帯 | 変換 | 日時/時間を指定した時間区切りに分割します。 | アクセス時間帯が朝かどうか|


##### ＜集計期間に関する特徴量＞

| 名前 | 種類 | 内容 | 特徴量の例 |
| ---- | ---- | ---- | ---------- |
| 直近～日での集計値 | 集約 | ある特徴量を、直近の日付に絞って計算するオプションを有効化します。他の特徴量と組み合わせて利用します。 | 直近90日間の動画視聴回数 |
| 集計値のトレンド(直前期との比較) | 集約 | ある特徴量を、直近の日付とその1期前の2つの期間でそれぞれ計算し、その差を計算します。 | 直近60日間の課金額とその前の60日間の課金額の差 |
| 集計値のトレンド(前年/前月との比較) | 集約 | ある特徴量を、直近の日付とその1期前の2つの期間でそれぞれ計算し、その差を計算します。 | 直近30日の総アクセス数と、前年同月の総アクセス数の差 |


##### ＜その他の特徴＞

| 名前 | 種類 | 内容 | 特徴量の例 |
| ---- | ---- | ---- | ---------- |
| ドメイン(URL) | 変換 | URLからトップレベルドメインを抽出します。 | リファラのドメイン |
| ドメイン(E-Mail) | 変換 | E-Mailアドレスからドメイン部を抽出します。 | 申し込みアドレスのドメイン |

### 分析結果の確認(ワークフローから作成)

分析した結果の確認方法を説明します。\
\
分析が完了すると、分析結果([分析の名前])画面に結果の一覧が表示されます。\
分析結果の一覧は、以下の2種類の画面を切り換えて確認できます。目的に応じて選択してください。
- [セグメント]画面：セグメント(細分化したグループ)ごとに、どの程度改善の余地があるのか、どれくらい平均より優れているのか
- [特徴量]画面：どの特徴量をどの程度変化させると、目的変数がどの程度改善するのか

なお、[AFE - ②目的変数設定]画面の[分析の目的]にて、「特徴量自動生成」を選択した場合は、分析結果の一覧は表示されません。

<Img src="/assets/img/capture/capture-analyze-7.png" alt="分析結果([分析の名前])画面" client:load />

:::note{.hint}
ヒント

- すでにAFEを実行済みのプロジェクトに対して、分析結果を確認する場合は、[ワークフロー]画面にて、分析結果([分析の名前])画面をクリックしてください。
- 生成される特徴量は、種類に応じて以下のようなアイコンで表示されます。

  | 種類 | アイコン |
  | ---- | -------- |
  | 四則演算 | :big-icon[/assets/img/common/feat_arithmetic.svg,四則演算] |
  | 時間に関する特徴 | :big-icon[/assets/img/common/feat_time.svg,時間に関する特徴] |
  | 集計全般 | :big-icon[/assets/img/common/feat_aggregate.svg,集計全般] |
  | URL | :big-icon[/assets/img/common/feat_url.svg,URL] |
  | Email | :icon[/assets/img/common/feat_email.svg,Email] |
  | その他 | :big-icon[/assets/img/common/feat_other.svg,その他] |
  | 元のデータ | なし |
:::

#### セグメント一覧画面
:version[2.1.4]

[セグメント]画面を選択すると、セグメントベースの特徴量の一覧が表示されます。

<Img src="/assets/img/capture/capture-analyze-8.png" alt="AFE目的変数のプレビュー画面" client:load />

1. クリックすると、分析の概要が表示されます。
1. 信頼度を表示しています。\
   機械学習に基づく統計的な信頼度を示しています。星の数が多いほど信頼できるAFE結果となります。
1. クリックすると、一覧に表示するデータの絞り込みができます。\
   フィルター条件は、5つまで追加できます。\
   なお、フィルターを追加してもセグメントの特徴量の境界値、改善効果は変化しません。\
   フィルターを解除する場合は、フィルターアイコンの[×]ボタンをクリックしてください。
1. セグメント種別を切り換えることにより、セグメントの並び順を変更できます。
   - [要改善]を選択した場合：\
     改善効果が大きい順に表示します。
   - [優良層]を選択した場合：\
     目的変数の生成時に「最大化」を選択した場合は、目的変数の数値が 高い順に、「最小化」を選択した場合は、目的変数の数値が低い順に表示します。
1. クリックすると、セグメントの一覧をCSVファイルでエクスポートします。
1. セグメントの説明を表示しています。\
   説明部分をクリックすると、[プロット]画面が表示されます。\
   [プロット]画面の詳細については、後述の「[プロット画面](#プロット画面)」を参照してください。
1. セグメントの改善効果を表示しています。
   - [要改善]を選択した場合：\
     このセグメントに現実的な範囲で施策を打ったときに、改善しうる幅を、改善効果として表示しています。
   - [優良層]を選択した場合：\
     このセグメントにおける目的変数の平均と、全体平均との差分が表示されます。

   データのばらつきが大きい、データ数が少ないなどの要因により、再分析するとセグメントの切り方が変化する可能性がある場合、:icon[/assets/img/common/icon-segment-notice.png,セグメント]マークが表示されます。この場合でも、シミュレーションの精度への影響はありません。
1. チェックを入れると、[エクスポート]ボタンと、[ターゲット作成]ボタンが表示されます。\
   複数にチェックを入れた場合は、複数セグメントの一括エクスポートができます。\
   なお、複数指定する場合は、1つ目のカードにチェックを入れると、2つ目以降はカード自体をクリックして指定することができます。
1. クリックすると、2軸目(項目番号10)が表示されセグメントの条件を追加できます。
1. 項目番号6のセグメントに対して、2軸目となるセグメントの条件を表示します。\
   構成比、および改善効果は2つの特徴量のAND条件で絞ったセグメントの結果となっています。\
   説明部分をクリックすると、[クロス集計]画面が表示されます。\
   [クロス集計]画面の詳細については、「[クロス集計画面](#クロス集計画面)」を参照してください。
1. クリックすると2軸目のセグメントの条件を切り換えられます。
1. クリックすると、チェックを入れたセグメントの内容をエクスポートできます。
1. クリックすると、チェックボックス(項目番号8)にチェックを入れたセグメントでターゲットを作成することができます。\
   詳細については、「[施策の効果を測定する](#施策の効果を測定する)」を参照してください。

#### 特徴量一覧画面

[特徴量]画面を選択すると、特徴量の一覧が、改善効果の大きい順に表示されます。\
対象となるセグメントはデータ全体となります。

<Img src="/assets/img/capture/capture-analyze-11.png" alt="特徴量一覧画面" client:load />

1. クリックすると、分析の概要が表示されます。
1. 信頼度を表示しています。\
   機械学習に基づく統計的な信頼度を表示しています。星の数が多いほど信頼できるAFE結果となります。
1. クリックすると、一覧に表示するデータの絞り込みができます。\
   フィルター条件は、5つまで追加できます。\
   なお、フィルターを追加してもセグメントの特徴量の境界値、改善効果は変化しません。\
   フィルターを解除する場合は、フィルターアイコンの[×]ボタンをクリックしてください。
1. セグメント種別を切り換えることにより、セグメントの並び順を変更できます。 特徴量一覧自体の表示には影響しませんが、分析結果の各画面にてセグメント一覧の並び順を切り換えることができます。
   - [要改善]を選択した場合：\
     改善効果が大きい順にセグメントを表示します。
   - [優良層]を選択した場合：\
     目的変数の生成時に「最大化」を選択した場合は、目的変数の数値が高い順に、「最小化」を選択した場合は、目的変数の数値が低い順にセグメントを表示します。
1. クリックすると、特徴量の一覧をCSVファイルでエクスポートします。
1. 特徴量の説明を表示しています。 説明部分をクリックすると、[プロット]画面が表示されます。[プロット]画面の詳細については、後述の「[プロット画面](#プロット画面)」を参照してください。
1. 特徴量の変化量を表示しています。データ全体に対して、特徴量を中央値付近で10パーセンタイル分動かしたときの変化量を意味しています。
1. 特徴量の改善効果を表示しています。\
   分析対象となるデータ全体に対して、左側に書かれた特徴量を中央値付近で特徴量の変化量分だけ変更し、シミュレーションしたときの改善効果を示しています。
1. チェックボックスにチェックを入れると、[シミュレーション]ボタンが表示されます。\
   なお、複数指定する場合は、1つ目のカードにチェックを入れると、2つ目以降はカード自体をクリックして指定することができます。
1. チェックを入れた特徴量に関するシミュレーションをおこないます。\
   シミュレーションの詳細は、「[シミュレーションをする](#シミュレーションをする)」を参照してください。

#### プロット画面

[プロット]画面では、特徴量と目的変数の関係をグラフで表示します。\
目的変数に対する特徴量の影響を確認できます。

<Img src="/assets/img/capture/capture-analyze-9.png" alt="プロット画面" client:load />

1. 横軸に特徴量、縦軸に目的変数とデータカウント数を示したグラフを表示します。全体の傾向の把握、注目するセグメントの確認ができます。
   - 横軸の特徴量は一定間隔で区切られており、その区間における目的変数の平均(上縦軸)とデータカウント数(下縦軸)を表示しています。
   - グラフ上で範囲選択すると、その範囲をセグメントとすることができ、分析結果の絞り込みにも使用できます。\
     [Shift]キー+左クリックで連続した部分を複数選択できます。
   - 横軸がカテゴリ型の場合は、[Ctrl]キー(Mac OSの場合は[Command⌘]キー)+左クリックでとびとびの範囲を指定することもできます。:version[2.1.6]

   また、グラフ右横に表示されるボタンにて、特徴量の区切りを10分類、または50分類に切り換えることができます。
1. クリックすると特徴量の一覧が表示されます。一覧から特徴量を指定することにより、グラフの横軸を切り換えることができます。
1. 有効なセグメント(1軸)を表示します。\
   クリックすると、セグメントが選択されます。
1. 有効な2軸の分析(クロス分析)を表示しています。\
   2軸の内の上から1つ目は現在表示している特徴量となります。クリックすると表示している2軸を用いたクロス集計に切り換わります。
1. プロットで使用しているデータをCSVファイルでエクスポートします。
1. クリックすると画面右側の説明領域の表示/非表示を切り換えることができます。
1. セグメントの説明が表示されます。\
   [編集]ボタンをクリックすると、セグメントの範囲を直接指定することができます。その場合、グラフ上の区間の切り方が変化します。
1. セグメントの情報を保存できます。保存されたセグメントは、セグメント一覧画面のトップに表示されます。
1. 選択されているセグメントが全体に占める割合、目的変数の平均値を表示しています。
1. 選択中のセグメントと、その他(セグメント外)において、目的変数の差が、どのような要因で生まれているかを可視化します。
1. 選択中のセグメントとその他(セグメント外)の特徴量の値を比較するテーブルを表示します。\
   選択中のセグメントとその他における差が、統計的に大きい順番に並んでいます。
1. 選択したセグメントに対するシミュレーションをおこないます。 シミュレーションの詳細は、「[シミュレーションをする](#シミュレーションをする)」を参照してください。

#### クロス集計画面

[クロス集計]画面では、2つの特徴量を掛け合わせて目的変数との関係を表示します。

<Img src="/assets/img/capture/capture-analyze-10.png" alt="クロス集計画面" client:load />

1. 2つのクロス集計テーブルをCSVファイルでエクスポートします。
1. 縦軸と横軸に特徴量を設定し、目的変数やデータ数(カウント)を表示したテーブルを表示します。\
   グラフ上で複数選択([Shift]キー+左クリック)することで、その範囲に含まれるデータをセグメントとすることができます。
1. クリックすると、表示するデータの範囲を切り換えることができます。
1. 特徴量の一覧が表示されます。一覧から特徴量を指定するとその特徴量を横軸としたプロット画面に移動します。
1. 有効なセグメント(2軸)を表示します。 クリックすると、セグメントが選択されます。
1. 現在表示している縦軸の特徴量を固定して、横軸を変化させたときに有効な2軸目を表示しています。\
   クリックすると表示している横軸が変化します。
1. クリックすると画面右側の説明領域(項目番号8以降)の表示/非表示を切り換えることができます。
1. セグメントの説明が表示されます。\
   [編集]ボタンをクリックすると、セグメントの範囲を直接指定することができます。
1. セグメントの情報を保存できます。保存されたセグメントは、セグメント一覧画面のトップに表示されます。保存されたセグメントは名前の変更や削除をすることができ、気になるセグメントを後で見返すときに使います。
1. 選択されているセグメントの全体に対する割合(構成比)、選択セグメントにおける目的変数の平均値を表示しています。
1. 選択中のセグメントと、その他(セグメント外)において、目的変数の差が、どのような要因で生まれているかを可視化します。
1. クリックすると、選択中のセグメントとその他(セグメント外)の特徴量の値を比較するテーブルを表示します。
1. クリックすると、選択したセグメントに対するシミュレーションをおこないます。\
   シミュレーションの詳細は、「[シミュレーションをする](#シミュレーションをする)」を参照してください。

### シミュレーションをする

シミュレーションの実行と結果の確認方法を説明します。\
シミュレーションを用いることで、対象のセグメントにはどんな施策が有効かを分析することができます。

#### シミュレーションの実行

シミュレーションを実行する方法を説明します。\
分析結果の画面から[シミュレーション]ボタンをクリックして実行します。

:::note{.hint}
ヒント

分析結果の画面で指定したセグメントに対して、特徴量を変化させた場合の効果をシミュレーションできます。分析結果の各画面の詳細は、「[分析結果の確認](#分析結果の確認ワークフローから作成)」を参照してください。
:::

#### シミュレーション結果の確認

指定されたセグメントに対して特徴量を変更したときの効果(目的変数の変化)を表示します。

<Img src="/assets/img/capture/capture-simulation-1.png" alt="シミュレーション結果画面" client:load />

1. 選択したセグメントが表示されます。
1. クリックすると特徴量の一覧が表示されます。一覧から特徴量を指定するとその特徴量を横軸としたプロット画面に移動します。
1. 特徴量の値を変化させます。\
   各項目は、数値入力、またはスライドバーで設定できます。
   - その特徴量を変化させた場合に、目的変数にどの程度の影響があるかをバーの色で表しています。\
     青色は、目的変数が改善する方向を示します。色が濃いほど改善効果が高くなります。\
     グレーは、目的変数が悪くなる方向を示します。色が濃いほどマイナス効果が高くなります。\
     あまり実データがない極端な値を指定した場合は、スライドバー左横に「上位N％」、「下位N％」と表示されます。
   - 数値型のパラメータの場合は選択セグメントの平均値が表示されます。シミュレーションすると、加えた変化量をすべてのデータに加減算します。
   - カテゴリ型のパラメータの場合は、カテゴリ名とそのカテゴリが占める割合が表示されます。割合を変更してシミュレーションすると、そのカテゴリ以外の割合は均等に加減算されます。
   - 特徴量にマウスカーソルを合わせると特徴量名全体が表示されます。
1. クリックすると、特徴量を削除できます。
1. クリックすると、特徴量を追加できます。
1. シミュレーション結果の内容が表示されます。

### 施策の効果を測定する

施策を実施した前後の効果を測定する方法について説明します。\
施策の実施、および効果測定にあたり、まず測定対象とするセグメントでターゲットを作成する必要があります。

#### ターゲットとは

月ごと、毎半期ごとに施策の結果を追いかけたいといった場合、分析対象のデータセットを最新のものに更新すると、セグメントの中身が変わってしまいます。\
(直近180日間におけるEC商品Aの購入回数が0回以下の顧客をセグメントとした場合)

<Img src="/assets/img/capture/fig-timeline-1.png" alt="ターゲットとは" client:load />

<Img src="/assets/img/capture/fig-timeline-2.png" alt="ターゲットとは" client:load />

これでは、特定のセグメントに対しておこなった施策の効果を測定することができません。そこで、ある時点でセグメントに含まれるデータをターゲットとして固定します。\
ターゲットにおける目的変数と特徴量の変化を継続的に確認することにより、施策を実施した前後の効果を測定できるようになります。

#### ターゲットの作成

ターゲットの作成方法について説明します。\
ターゲットを作成後、続けて施策実施用にターゲットのデータをエクスポートします。

:::note{.point}
ポイント

ターゲットを作成するにあたり、以下の点に注意してください。
- 分析の際、[AFE - ②目的変数設定]画面で以下のいずれかに該当する設定をした場合は、ターゲットを作成できません。
  - 時系列データを1つも選択しなかった場合
  - [集計オプション]の「指定したイベントからN日間を集約」、または「イベントまでのデータで分析する」を選択した場合
:::

###### ＜ターゲットの作成＞

1. 分析結果([分析の名前])-[セグメント]画面で、ターゲットに指定するセグメントのチェックボックスにチェックを入れ、[ターゲット作成]ボタンをクリックします。

   <Img src="/assets/img/capture/capture-timeline-1.png" alt="[セグメント]画面" client:load />

1. [ターゲット作成]画面が表示されますので、各種項目を設定し[ターゲット作成]ボタンをクリックします。

   <Img src="/assets/img/capture/capture-timeline-2.png" alt="[セグメント]画面" client:load />

   1. セグメントをランダムに2分割してターゲットを作成するかどうかを選択できます。\
      セグメントを分割しない場合は、下図のようにセグメントの条件に合致するデータ全件に対して施策を打ち、効果測定することができます。

      <Img src="/assets/img/capture/fig-timeline-3.png" alt="分析対象" client:load />

      セグメントを分割した場合は、下図のようにセグメントの条件に合致するデータをターゲットA、ターゲットBの2つに分割します。これにより分割された片方のグループにだけ施策を打つようなABテストをすることができます。

      <Img src="/assets/img/capture/fig-timeline-4.png" alt="分析対象" client:load />

   1. 特徴量の集計期間を直近までに補正してターゲットを作成するかどうかを選択できます。\
      たとえば直近30日間の顧客IDごとの売上について分析をした場合、セグメントに含まれるかどうかの判定には、30日前までの古いデータを用いています。\
      直近のデータで特徴量を正しく再計算し、ターゲットを作成する場合にはチェックボックスにチェックを入れます。\
      なお、上記の画面のようにプレビュー表示されますので、補正される期間を事前に確認することができます。

1. [ターゲット]画面に作成したターゲットが追加されますので、[エクスポート]ボタンをクリックしてターゲットに含まれるデータのリストをエクスポートします。\
   画面の見方については、「[ターゲット画面の見方](#ターゲット画面の見方)」、エクスポート手順の詳細は、「[ターゲットのエクスポート画面](#ターゲットのエクスポート画面)」を参照してください。

   ##### ＜ターゲット画面の見方＞

   <Img src="/assets/img/capture/capture-timeline-3.png" alt="[ターゲット]画面" client:load />

   1. クリックすると、分析の概要が表示されます。
   1. 信頼度を表示しています。
   1. クリックすると、 [セグメント]画面が表示されます。
   1. クリックすると、 [特徴量]画面が表示されます。
   1. ターゲットの説明(ターゲット名、作成日、およびタイムラインのサムネイル)を表示しています。サブセグメントに分割してターゲットを作成した場合は、ターゲット名の前に[AB]アイコンが表示されます。\
      ターゲットに指定したセグメントに:icon[/assets/img/common/icon-segment-notice.png,セグメント]マークが付いている場合、ターゲットの説明の右上に:icon[/assets/img/common/icon-segment-notice-target.png,セグメントターゲット]マークが表示されます。\
      また、説明部分をクリックすると、[タイムライン]画面が表示されます。\
      [タイムライン]画面の詳細は、「[タイムラインの確認](#タイムラインの確認)」を参照してください。
   1. クリックすると、ターゲットの概要を表示します。\
      詳細については、後述の「[[ターゲットの概要]画面](#ターゲットの概要画面)」を参照してください。
   1. クリックすると、ターゲットをエクスポートできます。\
      詳細については、「[ターゲットのエクスポート画面](#ターゲットのエクスポート画面)」を参照してください。
   1. クリックすると、ターゲット名を変更できます。
   1. クリックすると、ターゲットの説明を変更できます。
   1. クリックすると、ターゲットを削除できます。

   ##### ＜[ターゲットの概要]画面＞

   ターゲットの概要を確認することができます。

   <Img src="/assets/img/capture/capture-timeline-4.png" alt="[ターゲットの概要]画面" client:load />

   | 項目名 | 説明 |
   | ----- | ----- |
   | 作成日時 | ターゲットを作成した日時が表示されます。 |
   | 元セグメント | ターゲットに指定したセグメントとオプションの説明が表示されます。 |
   | グループ | ターゲット内のグループの内訳が表示されます。 |
   |  | ターゲット作成時に指定したセグメントの分割設定によって、グループ化されたグループ名と各グループの件数、および合計件数が表示されます。 |
   |  | 例)ターゲットとして「直近180日間でのEC商品カテゴリが"商品A"の数が0回以下」を選択した場合のこの項目の表記と説明は以下のとおりです。 |
   |  | - ターゲット作成時に[セグメントをランダムに2分割する]チェックボックスにチェックを入れた場合 |
   |  | 　表記： |
   |  | 　　ターゲットA：1155行 |
   |  | 　　ターゲットB：1155行 |
   |  | 　　ターゲット外：2050行 |
   |  | 　　すべて：4360行 |
   |  | 　説明： |
   |  | 　　<Img src="/assets/img/capture/fig-timeline-4.png" alt="分析対象" client:load /> |
   |  | - ターゲット作成時に[セグメントをランダムに2分割する]チェックボックスのチェックをはずしていた場合： |
   |  | 　表記： |
   |  | 　　ターゲット：2310行 |
   |  | 　　ターゲット外：2050行 |
   |  | 　　すべて：4360行 |
   |  | 　説明： |
   |  | 　<Img src="/assets/img/capture/fig-timeline-3.png" alt="分析対象" client:load /> |

   ##### ＜ターゲットのエクスポート画面＞

   ターゲットの特徴量(時系列データから集計したもののみ)をCSVファイル、またはデータセットにエクスポートします。\
   エクスポートする特徴量は、複数指定することができます。

   - [CSVファイルとしてエクスポート]を選択した場合

     <Img src="/assets/img/capture/capture-timeline-5.png" alt="[ターゲットのエクスポート]画面" client:load />

     1. ファイル名を入力します。
     1. 区切り文字をプルダウンから選択します。

     エクスポートファイルのCSV形式は、以下のとおりです。
     | 特徴量(※) | ターゲット |
     | ---------- | ---------- |
     | 特徴量 | グループ名が出力されます。 |
     |  | - セグメントの分割設定をしている場合： |
     |  | 　「ターゲットA」、「ターゲットB」、「ターゲット外」 |
     |  | - 分割設定をしていない場合： |
     |  | 　「ターゲット」、「ターゲット外」 |

     ※[ターゲットのエクスポート]画面で選択した特徴量の数だけ、列が作成されます。

     | 例) |
     | --- |
     | 顧客マスタ.顧客ID,会員ポイント残高,購買日時の最終日からの経過日数,ターゲット |
     | 120124021,205,73,ターゲット |
     | 169704093,890,,ターゲット |
     | 126678306,1480,4,ターゲット |
     | 120865672,1160,4,ターゲット |
     | 186074292,560,342,ターゲット外 |

   - [データセットとしてエクスポート]を選択した場合

     <Img src="/assets/img/capture/capture-timeline-6.png" alt="[ターゲットのエクスポート]画面" client:load />

     1. エクスポートする方法を[新しいデータセットを作成]、または[データセットを更新]から選択します。
     1. 項目番号1で[新しいデータセットを作成]を選択した場合は、データセットの名前を入力します。\
        [データセットを更新]を選択した場合は、新たに更新用のデータセットの名前を入力する、またはプルダウンから更新するデータセットを選択します。

     エクスポートしたデータセットの形式は、以下のとおりです。

     | 特徴量(※) | ターゲット |
     | --------- | ---------- |
     | 特徴量 | グループ名が出力されます。 |
     |  | - セグメントの分割設定をしている場合： |
     |  | 　「ターゲットA」、「ターゲットB」、「ターゲット外」 |
     |  | - 分割設定をしていない場合： |
     |  | 　「ターゲット」、「ターゲット外」 |

     ※[エクスポート]画面で選択した特徴量の数だけ、列が作成されます。\
     例)
     | 顧客マスタ.顧客ID | 会員ポイント残高 | 購買日時の最終日からの経過日数 | ターゲット |
     | ---------------- | --------------- | ---------------------------- | --------- |
     | 120124021 | 205 | 73 | ターゲット |
     | 169704093 | 890 | 0 | ターゲット |
     | 126678306 | 1480 | 4 | ターゲット |
     | 120865672 | 1160 | 4 | ターゲット |
     | 186074292 | 560 | 342 | ターゲット外 |

1. エクスポートした内容を元に、ターゲットの詳細、および施策を実施する対象を確認してください。

#### タイムラインの確認

タイムラインの確認方法について説明します。\
[タイムライン]画面にて、特徴量(目的変数)の変化を時系列のグラフで確認、および比較することができます。\
なお、タイムラインで表示できる特徴量(目的変数)は、時系列で集計できるもののみとなります。

:::note{.point}
ポイント

タイムラインに最新のデータを取り込むには、以降の手順をする前に分析の元となったデータセットの更新、およびフローの実行が必要です。
- データセットの更新方法：\
  [データセット一覧]画面で分析の元となったデータセットを選択し、更新ボタン(以下画面の青枠部分)をクリックしてください。

  <Img src="/assets/img/capture/capture-timeline-7.png" alt="[データセット一覧]画面" client:load />

- フロー実行方法：\
  [ワークフロー]画面で[フロー実行]ボタン(以下画面の青枠部分)をクリックしてください。

  <Img src="/assets/img/capture/capture-timeline-8.png" alt="[ワークフロー]画面" client:load />

なお、フローを実行する場合は、[分析用データ]画面の左メニューの[更新]ボタンからすることもできます。\
詳細は、「[分析用データ画面](/guide/project-details/index.html#分析用データ画面)」を参照してください。\
また、データセットの更新やフローの実行を自動でする場合は、「[スケジュール](/guide/schedule-function/index.html)」を参照してください。
:::

1. [ターゲット]画面で、効果測定をするターゲットをクリックします。

   <Img src="/assets/img/capture/capture-timeline-9.png" alt="[ターゲット]画面" client:load />

1. [タイムライン]画面が表示されますので、時系列グラフにて特徴量(目的変数)の変化を確認します。

   <Img src="/assets/img/capture/capture-timeline-10.png" alt="[タイムライン]画面" client:load />

   1. 集計期間に対して、期間ごとの特徴量(目的変数)の値をグラフ化して表示します。\
      横軸は時間軸、縦軸に特徴量(目的変数)を2種類表示できます。\
      画面右側のパネルにて、グラフに表示する特徴量、グループ、集計単位、集計期間を指定することにより表示を切り換えることができます。\
      指定方法の詳細は、後述の各項目番号の説明を参照してください。\
      また、グラフ上にマウスカーソルを合わせると、その時点の特徴量(目的変数)の値がポップアップで表示されます。
   1. 2つの時点の特徴量(目的変数)、および2点間の増減値を表形式で表示します。これにより、施策前後など、2点間のデータを比較することができます。\
      2つの時点の指定は、プルダウンから選択できます。
   1. クリックすると、タイムラインの内容をエクスポートできます。\
      詳細は、「[ターゲットのエクスポート画面](#ターゲットのエクスポート画面)」を参照してください。
   1. グラフの縦軸に表示する特徴量(目的変数)をプルダウンから選択します。
   1. 比較用のグループをプルダウンから選択できます。
   1. クリックすると、ターゲットの概要を表示します。 詳細については、「[[ターゲットの概要]画面](#ターゲットの概要画面)」を参照してください。
   1. 集計する単位と期間を指定します。\
      集計単位は、「日ごと」、「週ごと(月曜始まり)」、「月ごと(1日始まり)」、「年ごと(1月1日始まり)」のいずれかから選択できます。\
      集計期間は、開始日と終了日を指定できます。
   1. クリックすると、画面上の設定がリセットされます。(前回保存した内容になります)
   1. クリックすると、設定した内容を保存します。\
      次回この画面を表示する際に、保存した内容で表示することができます。\
      なお、保存すると[ターゲット]画面に戻ります。

##### ＜タイムラインのエクスポート画面＞

タイムラインの集計データをCSVファイルとしてエクスポートします。

<Img src="/assets/img/capture/capture-timeline-11.png" alt="[タイムラインのエクスポート]画面" client:load />

1. エクスポートする特徴量(目的変数)をプルダウンから選択します。複数指定できます。
1. エクスポートするグループをプルダウンから選択します。複数指定できます。
1. ファイル名を入力します。
1. 区切り文字をプルダウンから選択します。

- エクスポートファイルのCSV形式(タイムライン)

  | 特徴量(目的変数)(※1) | グループ(※2) | 集計データ(※3) |
  | --------------------- | ------------- | --------------- |
  | 特徴量(目的変数) | グループ名が出力されます。 | 集計データ |
  |  | - セグメントの分割設定をしている場合： |  |
  |  | 　「ターゲットA」、「ターゲットB」、「ターゲット外」 |  |
  |  | - 分割設定をしていない場合： |  |
  |  | 　「ターゲット」、「ターゲット外」 |  |

※1：[タイムラインのエクスポート]画面で選択した特徴量(目的変数)の数だけ、行が作成されます。\
※2：[タイムラインのエクスポート]画面で選択したグループの数だけ、行が作成されます。\
※3：[タイムライン]画面で設定した集計単位ごとに集計期間分の列が作成されます。

| 例) |
| --- |
| 特徴量,グループ,Aug-17,Sep-17,Oct-17,Nov-17,Dec-17 |
| EC商品カテゴリが"商品A"の数,ターゲット,0,0,0,0,0 |
| EC商品カテゴリが"商品A"の数,ターゲット外,0.216792842,0.260839642,0.234686855,0.209222299,0.26496903 |
